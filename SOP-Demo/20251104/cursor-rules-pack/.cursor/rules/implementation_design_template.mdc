---
alwaysApply: false
---
# å®ç°è®¾è®¡æ–‡æ¡£å†…å®¹è§„èŒƒæ¨¡æ¿

> **ä½¿ç”¨åœºæ™¯**ï¼šå½“éœ€è¦ç¼–å†™æˆ–è¯„å®¡å®ç°è®¾è®¡æ–‡æ¡£æ—¶ï¼Œå‚è€ƒæ­¤æ¨¡æ¿ç¡®ä¿å†…å®¹å®Œæ•´æ€§ã€‚

---

## ğŸ“ æ ¸å¿ƒè§„èŒƒ

```yaml
implementation_design_content_standards:
  core_rule: "âš ï¸ å¼ºåˆ¶è¦æ±‚ï¼šå®ç°è®¾è®¡æ–‡æ¡£å¿…é¡»åŒ…å«å®Œæ•´çš„æŠ€æœ¯ç»†èŠ‚å’Œä½¿ç”¨æŒ‡å—"
  severity: "CRITICAL - æ–‡æ¡£å¿…é¡»å…·å¤‡å¯æ‰§è¡Œæ€§å’Œå¯ç†è§£æ€§"
  motto: "è®¾è®¡æ–‡æ¡£ä¸ä»…è¦è¯´æ¸…æ¥š'æ˜¯ä»€ä¹ˆ'ï¼Œæ›´è¦è¯´æ¸…æ¥š'æ€ä¹ˆç”¨'"
  
  # ===== å¿…éœ€å†…å®¹æ¸…å• =====
  mandatory_content_checklist:
    item_1_interface_definition:
      name: "æ¥å£å®šä¹‰ï¼ˆå¦‚æœæœ‰ï¼‰"
      required: true
      condition: "æ¶‰åŠå¯¹å¤–APIã€Serviceæ¥å£ã€RPCæ¥å£æ—¶å¿…é¡»å®šä¹‰"
      content:
        - "æ¥å£ç­¾åï¼šæ–¹æ³•åã€è¿”å›å€¼ç±»å‹ã€å‚æ•°ç±»å‹"
        - "å…¥å‚è¯´æ˜ï¼šæ¯ä¸ªå‚æ•°çš„å«ä¹‰ã€ç±»å‹ã€çº¦æŸã€ç¤ºä¾‹å€¼"
        - "å‡ºå‚è¯´æ˜ï¼šè¿”å›å€¼ç»“æ„ã€å­—æ®µå«ä¹‰ã€å¯èƒ½çš„çŠ¶æ€ç "
        - "å¼‚å¸¸è¯´æ˜ï¼šå¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹å’ŒåŸå› "
```

---

## 1ï¸âƒ£ æ¥å£å®šä¹‰è§„èŒƒ

### é€‚ç”¨åœºæ™¯
- å¯¹å¤–æä¾›çš„HTTP APIæ¥å£
- Serviceå±‚çš„ä¸šåŠ¡æ¥å£
- RPC/Feignè¿œç¨‹è°ƒç”¨æ¥å£
- å¯¹æ¥ç¬¬ä¸‰æ–¹çš„æ¥å£

### å¿…éœ€å†…å®¹

#### 1.1 æ¥å£ç­¾å
```java
public CalculationResult selectSecurityScene(
    SceneSelectionRequest request
) throws BusinessException
```

#### 1.2 å…¥å‚è¯´æ˜è¡¨æ ¼

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | çº¦æŸæ¡ä»¶ | ç¤ºä¾‹å€¼ |
|-------|------|-----|------|---------|--------|
| request | SceneSelectionRequest | æ˜¯ | åœºæ™¯é€‰å‹è¯·æ±‚å¯¹è±¡ | - | - |
| request.industryCode | Integer | æ˜¯ | å®¢æˆ·è¡Œä¸šä»£ç  | 1-99 | 1ï¼ˆé‡‘èï¼‰ |
| request.scenarioType | String | æ˜¯ | åœºæ™¯ç±»å‹ | æšä¸¾å€¼ | "AI_SECURITY_PLATFORM" |
| request.subScenario | String | å¦ | å­åœºæ™¯ | æšä¸¾å€¼ | "NETWORK_DATA_FUSION" |
| request.userInputParams | Map<String, String> | æ˜¯ | ç”¨æˆ·è¾“å…¥å‚æ•° | éç©º | {"dailyEPS": "5000"} |

**å‚æ•°æ ¡éªŒè§„åˆ™**ï¼š
- `industryCode`ï¼šå¿…é¡»åœ¨ç³»ç»Ÿæ”¯æŒçš„è¡Œä¸šåˆ—è¡¨ä¸­
- `scenarioType`ï¼šå¿…é¡»åŒ¹é… `ScenarioTypeEnum` æšä¸¾å€¼
- `userInputParams`ï¼šæ ¹æ®åœºæ™¯ç±»å‹éªŒè¯å¿…å¡«å‚æ•°

#### 1.3 å‡ºå‚è¯´æ˜è¡¨æ ¼

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | å¯èƒ½çš„å€¼ |
|-------|------|------|---------|
| calculationResult | CalculationResult | è®¡ç®—ç»“æœå¯¹è±¡ | - |
| calculationResult.success | Boolean | æ˜¯å¦æˆåŠŸ | true/false |
| calculationResult.materialItems | List<MaterialItem> | ç‰©æ–™æ¸…å• | - |
| calculationResult.totalAmount | BigDecimal | æ€»é‡‘é¢ | â‰¥0 |
| calculationResult.warningMessages | List<String> | è­¦å‘Šä¿¡æ¯åˆ—è¡¨ | - |
| calculationResult.errorCode | String | é”™è¯¯ç  | ä¸šåŠ¡é”™è¯¯ç  |

**è¿”å›å€¼ç»“æ„ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "materialItems": [
    {
      "productCode": "GPU-A100-80G",
      "productName": "NVIDIA A100 80GBæ˜¾å¡",
      "quantity": 16,
      "unitPrice": 80000.00,
      "totalPrice": 1280000.00
    }
  ],
  "totalAmount": 1280000.00,
  "warningMessages": [],
  "errorCode": null
}
```

#### 1.4 å¼‚å¸¸è¯´æ˜

| å¼‚å¸¸ç±»å‹ | è§¦å‘æ¡ä»¶ | é”™è¯¯ç  | å¤„ç†å»ºè®® |
|---------|---------|-------|---------|
| `IllegalArgumentException` | å‚æ•°æ ¡éªŒå¤±è´¥ | PARAM_INVALID | æ£€æŸ¥å‚æ•°æ ¼å¼å’Œçº¦æŸ |
| `BusinessException` | ä¸šåŠ¡è§„åˆ™æ ¡éªŒå¤±è´¥ | BIZ_ERROR | æŸ¥çœ‹é”™è¯¯æ¶ˆæ¯è¯´æ˜ |
| `NotFoundException` | æ•°æ®ä¸å­˜åœ¨ | NOT_FOUND | ç¡®è®¤æ•°æ®æ˜¯å¦å·²åˆ›å»º |
| `SystemException` | ç³»ç»Ÿå¼‚å¸¸ | SYSTEM_ERROR | è”ç³»æŠ€æœ¯æ”¯æŒ |

---

## 2ï¸âƒ£ ç±»/æ–¹æ³•æ³¨é‡Šè§„èŒƒ

### æ ¸å¿ƒåŸåˆ™
> **æ³¨é‡Šè¦è¯´æ¸…æ¥šä½¿ç”¨åœºæ™¯å’Œä½¿ç”¨æ–¹æ³•ï¼Œæä¾›å¯è¿è¡Œçš„ç¤ºä¾‹ä»£ç **

### 2.1 ç±»æ³¨é‡Šæ¨¡æ¿

```java
/**
 * AIå®‰å…¨åœºæ™¯é€‰å‹è®¡ç®—å™¨
 * 
 * <p><b>åŒ…è·¯å¾„</b>ï¼šcom.sangfor.cpq.scene.calculator
 * <p><b>é¡¹ç›®ä½ç½®</b>ï¼šsf-support-serviceï¼ˆæœ¬é¡¹ç›®ï¼‰
 * 
 * <p><b>èŒè´£è¯´æ˜</b>ï¼š
 * æ ¹æ®å®¢æˆ·è¡Œä¸šã€åœºæ™¯ç±»å‹å’Œç”¨æˆ·è¾“å…¥å‚æ•°ï¼Œè®¡ç®—æ‰€éœ€çš„ç‰©æ–™æ¸…å•å’Œä»·æ ¼ã€‚
 * 
 * <p><b>é€‚ç”¨åœºæ™¯</b>ï¼š
 * <ul>
 *   <li>AIå®‰å…¨å¹³å°åœºæ™¯ï¼ˆç½‘æ•°èåˆã€æ€åŠ¿æ„ŸçŸ¥ï¼‰</li>
 *   <li>AIå®‰å…¨è¿è¥åœºæ™¯ï¼ˆSOCã€æ—¥å¿—åˆ†æï¼‰</li>
 * </ul>
 * 
 * <p><b>æ ¸å¿ƒèƒ½åŠ›</b>ï¼š
 * <ol>
 *   <li>åœºæ™¯è¯†åˆ«ï¼šæ ¹æ®è¡Œä¸šå’Œåœºæ™¯ç±»å‹åŒ¹é…è§„åˆ™</li>
 *   <li>EPSè®¡ç®—ï¼šåŸºäºæ—¥å¿—é‡è®¡ç®—æ¯æ—¥EPS</li>
 *   <li>ç‰©æ–™ç”Ÿæˆï¼šæ ¹æ®è®¡ç®—ç»“æœç”Ÿæˆç‰©æ–™æ¸…å•</li>
 * </ol>
 * 
 * <p><b>ä½¿ç”¨ç¤ºä¾‹</b>ï¼š
 * <pre>{@code
 * // 1. æ„å»ºè¯·æ±‚å‚æ•°
 * Map<String, String> params = new HashMap<>();
 * params.put("dailyLogVolume", "500"); // æ¯æ—¥æ—¥å¿—é‡ï¼ˆGBï¼‰
 * params.put("retentionDays", "180");  // æ—¥å¿—ä¿ç•™å¤©æ•°
 * 
 * SceneSelectionRequest request = SceneSelectionRequest.builder()
 *     .industryCode(1) // é‡‘èè¡Œä¸š
 *     .scenarioType("AI_SECURITY_PLATFORM")
 *     .subScenario("NETWORK_DATA_FUSION")
 *     .userInputParams(params)
 *     .build();
 * 
 * // 2. è°ƒç”¨è®¡ç®—å™¨
 * SceneCalculator calculator = new SceneCalculator();
 * CalculationResult result = calculator.calculate(request);
 * 
 * // 3. è·å–ç»“æœ
 * List<MaterialItem> materials = result.getMaterialItems();
 * BigDecimal totalAmount = result.getTotalAmount();
 * System.out.println("ç‰©æ–™æ•°é‡ï¼š" + materials.size());
 * System.out.println("æ€»é‡‘é¢ï¼š" + totalAmount);
 * }</pre>
 * 
 * <p><b>ä¾èµ–è¯´æ˜</b>ï¼š
 * <ul>
 *   <li>ä¾èµ– {@link SceneRuleService} (com.sangfor.cpq.scene.service) æŸ¥è¯¢è§„åˆ™é…ç½®</li>
 *   <li>ä¾èµ– {@link ProductService} (com.sangfor.cpq.product.service) æŸ¥è¯¢äº§å“ä¿¡æ¯</li>
 *   <li>ä¾èµ– {@link PriceCalculator} (com.sangfor.cpq.price.calculator) è®¡ç®—ä»·æ ¼</li>
 * </ul>
 * 
 * <p><b>çº¿ç¨‹å®‰å…¨æ€§</b>ï¼šæœ¬ç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆæˆ–ï¼šæœ¬ç±»éçº¿ç¨‹å®‰å…¨ï¼Œæ¯æ¬¡ä½¿ç”¨è¯·åˆ›å»ºæ–°å®ä¾‹ï¼‰
 * 
 * @author xinjin
 * @date 2025-10-29
 * @see CalculationResult
 * @see SceneSelectionRequest
 * @since 1.0.0
 */
public class SceneCalculator {
    // ...
}
```

### 2.2 æ–¹æ³•æ³¨é‡Šæ¨¡æ¿

```java
/**
 * è®¡ç®—EPSï¼ˆæ¯ç§’äº‹ä»¶æ•°ï¼‰
 * 
 * <p><b>åŠŸèƒ½è¯´æ˜</b>ï¼š
 * æ ¹æ®æ¯æ—¥æ—¥å¿—é‡å’Œå³°å€¼å› å­è®¡ç®—æ¯æ—¥EPSï¼Œç”¨äºç¡®å®šæ‰€éœ€çš„æ—¥å¿—åˆ†æèƒ½åŠ›ã€‚
 * 
 * <p><b>è®¡ç®—å…¬å¼</b>ï¼š
 * <pre>
 * EPS = (dailyLogVolume * 1024 * 1024 * 1024) / (24 * 3600) * peakFactor
 * æœ€ç»ˆç»“æœå‘ä¸Šå–æ•´åˆ°ç™¾ä½
 * </pre>
 * 
 * <p><b>ä¸šåŠ¡è§„åˆ™</b>ï¼š
 * <ul>
 *   <li>é‡‘èè¡Œä¸šé»˜è®¤å³°å€¼å› å­ï¼š2.0</li>
 *   <li>æ”¿åºœè¡Œä¸šé»˜è®¤å³°å€¼å› å­ï¼š1.8</li>
 *   <li>åˆ¶é€ è¡Œä¸šé»˜è®¤å³°å€¼å› å­ï¼š1.5</li>
 * </ul>
 * 
 * @param dailyLogVolume æ¯æ—¥æ—¥å¿—é‡ï¼ˆGBï¼‰ï¼Œæœ‰æ•ˆèŒƒå›´ï¼š1-10000
 * @param peakFactor å³°å€¼å› å­ï¼Œæœ‰æ•ˆèŒƒå›´ï¼š1.0-5.0ï¼Œæ¨èå€¼2.0
 * @return æ¯æ—¥EPSå€¼ï¼ˆå‘ä¸Šå–æ•´åˆ°ç™¾ä½ï¼‰ï¼Œå•ä½ï¼šäº‹ä»¶/ç§’
 * @throws IllegalArgumentException å½“å‚æ•°è¶…å‡ºæœ‰æ•ˆèŒƒå›´æ—¶
 * 
 * <p><b>ä½¿ç”¨ç¤ºä¾‹1 - åŸºç¡€ç”¨æ³•</b>ï¼š
 * <pre>{@code
 * EpsCalculator calculator = new EpsCalculator();
 * 
 * // é‡‘èè¡Œä¸šï¼Œ500GBæ—¥å¿—ï¼Œä½¿ç”¨é»˜è®¤å³°å€¼å› å­
 * BigDecimal eps = calculator.calculateEPS(500, 2.0);
 * // ç»“æœï¼šçº¦5800 EPS
 * System.out.println("è®¡ç®—EPSï¼š" + eps);
 * }</pre>
 * 
 * <p><b>ä½¿ç”¨ç¤ºä¾‹2 - ä¸åŒè¡Œä¸šåœºæ™¯</b>ï¼š
 * <pre>{@code
 * EpsCalculator calculator = new EpsCalculator();
 * 
 * // æ”¿åºœè¡Œä¸šï¼Œ1000GBæ—¥å¿—ï¼Œå³°å€¼å› å­1.8
 * BigDecimal govEps = calculator.calculateEPS(1000, 1.8);
 * System.out.println("æ”¿åºœè¡Œä¸šEPSï¼š" + govEps);
 * 
 * // åˆ¶é€ è¡Œä¸šï¼Œ300GBæ—¥å¿—ï¼Œå³°å€¼å› å­1.5
 * BigDecimal mfgEps = calculator.calculateEPS(300, 1.5);
 * System.out.println("åˆ¶é€ è¡Œä¸šEPSï¼š" + mfgEps);
 * }</pre>
 * 
 * <p><b>ä½¿ç”¨ç¤ºä¾‹3 - å¼‚å¸¸å¤„ç†</b>ï¼š
 * <pre>{@code
 * EpsCalculator calculator = new EpsCalculator();
 * 
 * try {
 *     // å‚æ•°è¶…å‡ºèŒƒå›´ä¼šæŠ›å‡ºå¼‚å¸¸
 *     BigDecimal eps = calculator.calculateEPS(20000, 2.0);
 * } catch (IllegalArgumentException e) {
 *     log.error("å‚æ•°æ ¡éªŒå¤±è´¥ï¼š{}", e.getMessage());
 *     // ä½¿ç”¨é»˜è®¤å€¼æˆ–æç¤ºç”¨æˆ·ä¿®æ­£
 * }
 * }</pre>
 * 
 * @see #calculateEPSWithDefault(int) ä½¿ç”¨é»˜è®¤å³°å€¼å› å­çš„ç®€åŒ–æ–¹æ³•
 */
public BigDecimal calculateEPS(int dailyLogVolume, double peakFactor) {
    // å‚æ•°æ ¡éªŒ
    if (dailyLogVolume < 1 || dailyLogVolume > 10000) {
        throw new IllegalArgumentException(
            "æ¯æ—¥æ—¥å¿—é‡å¿…é¡»åœ¨1-10000GBä¹‹é—´ï¼Œå½“å‰å€¼ï¼š" + dailyLogVolume
        );
    }
    if (peakFactor < 1.0 || peakFactor > 5.0) {
        throw new IllegalArgumentException(
            "å³°å€¼å› å­å¿…é¡»åœ¨1.0-5.0ä¹‹é—´ï¼Œå½“å‰å€¼ï¼š" + peakFactor
        );
    }
    
    // è®¡ç®—é€»è¾‘
    // ...
}
```

### 2.3 å«è¯­å¥ï¼ˆGuard Clauseï¼‰ä½¿ç”¨è§„èŒƒ

#### æ ¸å¿ƒåŸåˆ™
> **ä¼˜å…ˆå¤„ç†å¼‚å¸¸/è¾¹ç•Œæƒ…å†µå¹¶æå‰è¿”å›ï¼Œè®©æ­£å¸¸ä¸šåŠ¡é€»è¾‘ä¿æŒæ‰å¹³æ¸…æ™°**

#### ä¸ºä»€ä¹ˆä½¿ç”¨å«è¯­å¥ï¼Ÿ
- âœ… **å‡å°‘åµŒå¥—**ï¼šé¿å…æ·±å±‚çš„if-elseåµŒå¥—ï¼Œä»£ç æ›´æ‰å¹³
- âœ… **é€»è¾‘æ¸…æ™°**ï¼šå¼‚å¸¸æƒ…å†µé›†ä¸­åœ¨å‰é¢ï¼Œæ­£å¸¸æµç¨‹åœ¨åé¢
- âœ… **æ˜“äºç»´æŠ¤**ï¼šæ–°å¢æ ¡éªŒåªéœ€åœ¨å‰é¢è¿½åŠ ï¼Œä¸å½±å“ä¸»æµç¨‹
- âœ… **ç¬¦åˆå¿«é€Ÿå¤±è´¥åŸåˆ™**ï¼šé—®é¢˜å°½æ—©å‘ç°ï¼Œå°½æ—©è¿”å›

#### å«è¯­å¥æ¨¡å¼

```java
/**
 * åœºæ™¯é€‰å‹ä¸»æµç¨‹
 * 
 * <p><b>åŒ…è·¯å¾„</b>ï¼šcom.sangfor.cpq.scene.service.impl
 * <p><b>é¡¹ç›®ä½ç½®</b>ï¼šsf-support-serviceï¼ˆæœ¬é¡¹ç›®ï¼‰
 */
public CalculationResult selectScene(SceneSelectionRequest request) {
    log.info("å¼€å§‹åœºæ™¯é€‰å‹è®¡ç®—ï¼Œè¯·æ±‚å‚æ•°ï¼š{}", request);
    
    // å‚æ•°éç©ºæ ¡éªŒ
    if (request == null) {
        log.error("è¯·æ±‚å‚æ•°ä¸èƒ½ä¸ºç©º");
        throw new IllegalArgumentException("è¯·æ±‚å‚æ•°ä¸èƒ½ä¸ºç©º");
    }
    
    // å¿…å¡«å­—æ®µæ ¡éªŒ
    if (request.getIndustryCode() == null) {
        log.error("è¡Œä¸šä»£ç ä¸èƒ½ä¸ºç©º");
        throw new IllegalArgumentException("è¡Œä¸šä»£ç ä¸èƒ½ä¸ºç©º");
    }
    if (StringUtils.isBlank(request.getScenarioType())) {
        log.error("åœºæ™¯ç±»å‹ä¸èƒ½ä¸ºç©º");
        throw new IllegalArgumentException("åœºæ™¯ç±»å‹ä¸èƒ½ä¸ºç©º");
    }
    
    // ä¸šåŠ¡è§„åˆ™æ ¡éªŒ
    List<SceneRule> rules = sceneMatcher.matchRules(
        request.getIndustryCode(), 
        request.getScenarioType()
    );
    if (CollectionUtils.isEmpty(rules)) {
        log.warn("æœªæ‰¾åˆ°åŒ¹é…çš„åœºæ™¯è§„åˆ™ï¼ŒindustryCode: {}, scenarioType: {}", 
            request.getIndustryCode(), request.getScenarioType());
        throw new BusinessException("æœªæ‰¾åˆ°åŒ¹é…çš„åœºæ™¯è§„åˆ™");
    }
    
    // æ­£å¸¸ä¸šåŠ¡æµç¨‹
    try {
        // æ­¥éª¤1ï¼šEPSè®¡ç®—
        BigDecimal eps = epsCalculator.calculate(
            request.getUserInputParams(),
            rules.get(0)
        );
        log.info("EPSè®¡ç®—å®Œæˆï¼ŒEPSå€¼ï¼š{}", eps);
        
        // æ­¥éª¤2ï¼šæ˜¾å¡è®¡ç®—
        GraphicsCardResult cardResult = graphicsCardCalculator.calculate(
            eps, rules, request.getUserInputParams()
        );
        log.info("æ˜¾å¡è®¡ç®—å®Œæˆï¼Œæ˜¾å¡å‹å·ï¼š{}ï¼Œæ•°é‡ï¼š{}", 
            cardResult.getCardSpec(), cardResult.getCardCount());
        
        // æ­¥éª¤3ï¼šæœåŠ¡å™¨è®¡ç®—
        ServerResult serverResult = serverCalculator.calculate(
            cardResult.getCardCount(),
            cardResult.getCardSpec(),
            rules
        );
        log.info("æœåŠ¡å™¨è®¡ç®—å®Œæˆï¼ŒæœåŠ¡å™¨æ•°é‡ï¼š{}", serverResult.getServerCount());
        
        // æ­¥éª¤4ï¼šç‰©æ–™ç”Ÿæˆ
        List<MaterialItem> materials = materialGenerator.generate(
            cardResult, serverResult, rules
        );
        log.info("ç‰©æ–™ç”Ÿæˆå®Œæˆï¼Œç‰©æ–™æ•°é‡ï¼š{}", materials.size());
        
        // æ­¥éª¤5ï¼šä»·æ ¼è®¡ç®—
        BigDecimal totalAmount = priceCalculator.calculate(materials);
        log.info("ä»·æ ¼è®¡ç®—å®Œæˆï¼Œæ€»é‡‘é¢ï¼š{}", totalAmount);
        
        // æ­¥éª¤6ï¼šæ„å»ºè¿”å›ç»“æœ
        CalculationResult result = CalculationResult.builder()
            .success(true)
            .materialItems(materials)
            .totalAmount(totalAmount)
            .build();
        
        log.info("åœºæ™¯é€‰å‹è®¡ç®—å®Œæˆ");
        return result;
        
    } catch (IllegalArgumentException e) {
        log.error("å‚æ•°æ ¡éªŒå¤±è´¥ï¼š{}", e.getMessage());
        throw e;
    } catch (BusinessException e) {
        log.error("ä¸šåŠ¡å¤„ç†å¤±è´¥ï¼š{}", e.getMessage());
        throw e;
    } catch (Exception e) {
        log.error("ç³»ç»Ÿå¼‚å¸¸", e);
        throw new SystemException("åœºæ™¯é€‰å‹è®¡ç®—å¤±è´¥", e);
    }
}
```

#### å¯¹æ¯”ç¤ºä¾‹ï¼šä¸ä½¿ç”¨å«è¯­å¥ vs ä½¿ç”¨å«è¯­å¥

**âŒ ä¸æ¨èï¼šæ·±å±‚åµŒå¥—**
```java
public CalculationResult selectScene(SceneSelectionRequest request) {
    if (request != null) {
        if (request.getIndustryCode() != null) {
            if (StringUtils.isNotBlank(request.getScenarioType())) {
                List<SceneRule> rules = sceneMatcher.matchRules(...);
                if (CollectionUtils.isNotEmpty(rules)) {
                    // æ­£å¸¸ä¸šåŠ¡é€»è¾‘ï¼ˆåµŒå¥—åœ¨ç¬¬4å±‚ï¼ï¼‰
                    BigDecimal eps = epsCalculator.calculate(...);
                    // ...
                } else {
                    throw new BusinessException("æœªæ‰¾åˆ°è§„åˆ™");
                }
            } else {
                throw new IllegalArgumentException("åœºæ™¯ç±»å‹ä¸ºç©º");
            }
        } else {
            throw new IllegalArgumentException("è¡Œä¸šä»£ç ä¸ºç©º");
        }
    } else {
        throw new IllegalArgumentException("è¯·æ±‚å‚æ•°ä¸ºç©º");
    }
}
```

**âœ… æ¨èï¼šå«è¯­å¥æ‰å¹³åŒ–**
```java
public CalculationResult selectScene(SceneSelectionRequest request) {
    // ä¼˜å…ˆå¤„ç†å¼‚å¸¸æƒ…å†µ
    if (request == null) {
        throw new IllegalArgumentException("è¯·æ±‚å‚æ•°ä¸ºç©º");
    }
    if (request.getIndustryCode() == null) {
        throw new IllegalArgumentException("è¡Œä¸šä»£ç ä¸ºç©º");
    }
    if (StringUtils.isBlank(request.getScenarioType())) {
        throw new IllegalArgumentException("åœºæ™¯ç±»å‹ä¸ºç©º");
    }
    
    List<SceneRule> rules = sceneMatcher.matchRules(...);
    if (CollectionUtils.isEmpty(rules)) {
        throw new BusinessException("æœªæ‰¾åˆ°è§„åˆ™");
    }
    
    // æ­£å¸¸ä¸šåŠ¡é€»è¾‘ï¼ˆæ‰å¹³æ¸…æ™°ï¼Œæ— åµŒå¥—ï¼‰
    BigDecimal eps = epsCalculator.calculate(...);
    // ...
}
```

### 2.4 æ³¨é‡Šè´¨é‡æ£€æŸ¥æ¸…å•

âœ… **å¿…éœ€åŒ…å«çš„å†…å®¹**ï¼š
- [ ] åŠŸèƒ½è¯´æ˜ï¼šæ¸…æ¥šæè¿°åšä»€ä¹ˆ
- [ ] ä¸šåŠ¡è§„åˆ™ï¼šè¯´æ˜å…³é”®çš„ä¸šåŠ¡çº¦æŸ
- [ ] å‚æ•°è¯´æ˜ï¼šæ¯ä¸ªå‚æ•°çš„å«ä¹‰ã€çº¦æŸã€ç¤ºä¾‹
- [ ] è¿”å›å€¼è¯´æ˜ï¼šè¿”å›ä»€ä¹ˆã€æ ¼å¼ã€å•ä½
- [ ] å¼‚å¸¸è¯´æ˜ï¼šä»€ä¹ˆæƒ…å†µæŠ›å¼‚å¸¸
- [ ] ä½¿ç”¨ç¤ºä¾‹ï¼šè‡³å°‘1ä¸ªå¯è¿è¡Œçš„å®Œæ•´ç¤ºä¾‹
- [ ] @authorï¼šä½œè€…ä¿¡æ¯
- [ ] @dateï¼šåˆ›å»ºæ—¥æœŸ
- [ ] **åŒ…è·¯å¾„å’Œé¡¹ç›®ä½ç½®**ï¼ˆæ–°å¢å¿…éœ€ï¼‰
- [ ] **å«è¯­å¥ä¼˜åŒ–**ï¼ˆæ–°å¢å»ºè®®ï¼‰ï¼šæ–¹æ³•å†…æœ‰å‚æ•°æ ¡éªŒæˆ–è¾¹ç•Œæ£€æŸ¥æ—¶ï¼Œä½¿ç”¨å«è¯­å¥å‡å°‘åµŒå¥—

âŒ **é¿å…çš„æ³¨é‡Š**ï¼š
- ç©ºæ´æ— æ„ä¹‰çš„æ³¨é‡Šï¼ˆå¦‚ï¼š`// è®¡ç®—` for a method named `calculate`ï¼‰
- è¿‡æ—¶çš„æ³¨é‡Šï¼ˆä»£ç æ”¹äº†æ³¨é‡Šæ²¡æ”¹ï¼‰
- é‡å¤ä»£ç é€»è¾‘çš„æ³¨é‡Šï¼ˆæ³¨é‡Šå’Œä»£ç è¯´åŒä¸€ä»¶äº‹ï¼‰

---

## 3ï¸âƒ£ æ•°æ®åº“è¡¨å®šä¹‰è§„èŒƒ

### é€‚ç”¨åœºæ™¯
- æ–°å¢ä¸šåŠ¡è¡¨
- ä¿®æ”¹ç°æœ‰è¡¨ç»“æ„
- æ¶‰åŠæ•°æ®æŒä¹…åŒ–çš„åŠŸèƒ½

### 3.1 è¡¨å®šä¹‰æ¨¡æ¿

#### è¡¨åŸºæœ¬ä¿¡æ¯

**è¡¨å**ï¼š`tk_sf_cpq_scene_selection_rule`

**è¡¨è¯´æ˜**ï¼šå­˜å‚¨AIå®‰å…¨åœºæ™¯é€‰å‹çš„ä¸šåŠ¡è§„åˆ™é…ç½®ï¼Œæ”¯æŒæŒ‰è¡Œä¸šå’Œåœºæ™¯ç±»å‹åŒ¹é…è§„åˆ™

**å­˜å‚¨å¼•æ“**ï¼šInnoDB

**å­—ç¬¦é›†**ï¼šutf8mb4

#### å­—æ®µå®šä¹‰è¡¨æ ¼

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | éç©º | é»˜è®¤å€¼ | æ³¨é‡Š | ä¸šåŠ¡è¯´æ˜ |
|-------|------|-----|-----|--------|------|---------|
| id | BIGINT | - | æ˜¯ | è‡ªå¢ | ä¸»é”®ID | - |
| rule_code | VARCHAR | 50 | æ˜¯ | - | è§„åˆ™ç¼–ç  | å…¨å±€å”¯ä¸€ï¼Œå¦‚ï¼šFIN_AI_PLAT_001 |
| rule_name | VARCHAR | 200 | æ˜¯ | - | è§„åˆ™åç§° | ä¸šåŠ¡å¯è¯»çš„è§„åˆ™æè¿° |
| industry_code | INT | - | å¦ | NULL | é€‚ç”¨è¡Œä¸šä»£ç  | NULLè¡¨ç¤ºå…¨è¡Œä¸šé€‚ç”¨ |
| scenario_type | VARCHAR | 50 | æ˜¯ | - | åœºæ™¯ç±»å‹ | æšä¸¾å€¼ï¼Œå¦‚ï¼šAI_SECURITY_PLATFORM |
| sub_scenario | VARCHAR | 50 | å¦ | NULL | å­åœºæ™¯ | æšä¸¾å€¼ï¼Œå¦‚ï¼šNETWORK_DATA_FUSION |
| rule_expression | TEXT | - | æ˜¯ | - | è§„åˆ™è¡¨è¾¾å¼ | JSONæ ¼å¼å­˜å‚¨è§„åˆ™é€»è¾‘ |
| priority | INT | - | æ˜¯ | 100 | ä¼˜å…ˆçº§ | æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œ1-999 |
| status | TINYINT | - | æ˜¯ | 1 | çŠ¶æ€ | 0-ç¦ç”¨ï¼Œ1-å¯ç”¨ |
| created_by | VARCHAR | 50 | æ˜¯ | - | åˆ›å»ºäºº | ç”¨æˆ·IDæˆ–ç”¨æˆ·å |
| created_time | DATETIME | - | æ˜¯ | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ | è®°å½•åˆ›å»ºæ—¶é—´ |
| updated_by | VARCHAR | 50 | å¦ | - | æ›´æ–°äºº | ç”¨æˆ·IDæˆ–ç”¨æˆ·å |
| updated_time | DATETIME | - | å¦ | NULL ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ | è®°å½•æœ€åä¿®æ”¹æ—¶é—´ |

#### ç´¢å¼•å®šä¹‰

| ç´¢å¼•å | ç´¢å¼•ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|-------|---------|------|------|
| PRIMARY | ä¸»é”® | id | - |
| uk_rule_code | å”¯ä¸€ç´¢å¼• | rule_code | ä¿è¯è§„åˆ™ç¼–ç å”¯ä¸€ |
| idx_industry_scenario | æ™®é€šç´¢å¼• | industry_code, scenario_type | åŠ é€ŸæŒ‰è¡Œä¸šå’Œåœºæ™¯æŸ¥è¯¢ |
| idx_status_priority | æ™®é€šç´¢å¼• | status, priority | åŠ é€Ÿå¯ç”¨è§„åˆ™çš„ä¼˜å…ˆçº§æ’åº |

#### å®Œæ•´DDL

```sql
CREATE TABLE tk_sf_cpq_scene_selection_rule (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ä¸»é”®ID',
    rule_code VARCHAR(50) NOT NULL COMMENT 'è§„åˆ™ç¼–ç ï¼Œå…¨å±€å”¯ä¸€',
    rule_name VARCHAR(200) NOT NULL COMMENT 'è§„åˆ™åç§°',
    industry_code INT COMMENT 'é€‚ç”¨è¡Œä¸šä»£ç ï¼ŒNULLè¡¨ç¤ºå…¨è¡Œä¸š',
    scenario_type VARCHAR(50) NOT NULL COMMENT 'åœºæ™¯ç±»å‹',
    sub_scenario VARCHAR(50) COMMENT 'å­åœºæ™¯',
    rule_expression TEXT NOT NULL COMMENT 'è§„åˆ™è¡¨è¾¾å¼ï¼ˆJSONæ ¼å¼ï¼‰',
    priority INT NOT NULL DEFAULT 100 COMMENT 'ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜',
    status TINYINT NOT NULL DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-å¯ç”¨',
    created_by VARCHAR(50) NOT NULL COMMENT 'åˆ›å»ºäºº',
    created_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_by VARCHAR(50) COMMENT 'æ›´æ–°äºº',
    updated_time DATETIME ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    UNIQUE KEY uk_rule_code (rule_code),
    KEY idx_industry_scenario (industry_code, scenario_type),
    KEY idx_status_priority (status, priority)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åœºæ™¯é€‰å‹è§„åˆ™è¡¨';
```

#### ç¤ºä¾‹æ•°æ®

```sql
INSERT INTO tk_sf_cpq_scene_selection_rule 
(rule_code, rule_name, industry_code, scenario_type, sub_scenario, rule_expression, priority, created_by) 
VALUES 
(
    'FIN_AI_PLAT_001',
    'é‡‘èè¡Œä¸š-AIå®‰å…¨å¹³å°-ç½‘æ•°èåˆåœºæ™¯',
    1,
    'AI_SECURITY_PLATFORM',
    'NETWORK_DATA_FUSION',
    '{"epsCalculation":{"peakFactor":2.0},"graphicsCard":{"gpuPerServer":8}}',
    10,
    'system'
);
```

### 3.2 è¡¨å…³ç³»å›¾ï¼ˆå¦‚æœ‰å¤šè¡¨å…³è”ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ tk_sf_cpq_scene_selection_rule â”‚
â”‚ (åœºæ™¯é€‰å‹è§„åˆ™è¡¨)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ 1
              â”‚
              â”‚ N
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ tk_sf_cpq_material_mapping  â”‚
â”‚ (ç‰©æ–™æ˜ å°„è¡¨)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ 1
              â”‚
              â”‚ N
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ tk_sf_cpq_product           â”‚
â”‚ (äº§å“è¡¨)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4ï¸âƒ£ èƒ½åŠ›åˆ†è§£ä¸ç¼–æ’è§„èŒƒ

### æ ¸å¿ƒåŸåˆ™
> **ä¸šåŠ¡åŠŸèƒ½è¦æ‹†è§£ä¸ºå­èƒ½åŠ›ï¼Œæ˜ç¡®ç¼–æ’é€»è¾‘å’Œæ•°æ®æµå‘ï¼Œå¹¶è¯´æ˜æ¯ä¸ªç±»çš„åŒ…è·¯å¾„å’Œé¡¹ç›®ä½ç½®**

### 4.1 èƒ½åŠ›æ¸…å•æ¨¡æ¿

**ä¸šåŠ¡åŠŸèƒ½**ï¼šAIå®‰å…¨åœºæ™¯é€‰å‹

**åŠŸèƒ½ç›®æ ‡**ï¼šæ ¹æ®å®¢æˆ·éœ€æ±‚ï¼Œè‡ªåŠ¨è®¡ç®—æ‰€éœ€çš„ç‰©æ–™æ¸…å•å’Œä»·æ ¼

**å­èƒ½åŠ›æ¸…å•è¡¨æ ¼**

| åºå· | èƒ½åŠ›åç§° | åŒ…è·¯å¾„ | é¡¹ç›®ä½ç½® | èŒè´£æè¿° | è¾“å…¥ | è¾“å‡º | ä¾èµ– |
|-----|---------|--------|---------|---------|------|------|------|
| 1 | ParameterValidatorï¼ˆå‚æ•°æ ¡éªŒå™¨ï¼‰ | com.sangfor.cpq.scene.validator | sf-support-service | æ ¡éªŒç”¨æˆ·è¾“å…¥å‚æ•°çš„åˆæ³•æ€§ | ç”¨æˆ·è¾“å…¥å‚æ•°Map | æ ¡éªŒç»“æœBoolean | - |
| 2 | SceneMatcherï¼ˆåœºæ™¯åŒ¹é…å™¨ï¼‰ | com.sangfor.cpq.scene.matcher | sf-support-service | æ ¹æ®è¡Œä¸šå’Œåœºæ™¯ç±»å‹åŒ¹é…è§„åˆ™ | è¡Œä¸šä»£ç ã€åœºæ™¯ç±»å‹ | åŒ¹é…çš„è§„åˆ™åˆ—è¡¨ | SceneRuleMapper |
| 3 | EpsCalculatorï¼ˆEPSè®¡ç®—å™¨ï¼‰ | com.sangfor.cpq.scene.calculator | sf-support-service | è®¡ç®—æ¯æ—¥äº‹ä»¶å¤„ç†é€Ÿç‡ | æ—¥å¿—é‡ã€å³°å€¼å› å­ | EPSå€¼ | - |
| 4 | GraphicsCardCalculatorï¼ˆæ˜¾å¡è®¡ç®—å™¨ï¼‰ | com.sangfor.cpq.scene.calculator | sf-support-service | è®¡ç®—æ‰€éœ€æ˜¾å¡æ•°é‡å’Œè§„æ ¼ | EPSã€ä¸šåŠ¡å‚æ•° | æ˜¾å¡è§„æ ¼å’Œæ•°é‡ | - |
| 5 | ServerCalculatorï¼ˆæœåŠ¡å™¨è®¡ç®—å™¨ï¼‰ | com.sangfor.cpq.scene.calculator | sf-support-service | è®¡ç®—æ‰€éœ€æœåŠ¡å™¨æ•°é‡å’Œé…ç½® | æ˜¾å¡æ•°é‡ã€é…ç½®è¦æ±‚ | æœåŠ¡å™¨è§„æ ¼å’Œæ•°é‡ | - |
| 6 | MaterialGeneratorï¼ˆç‰©æ–™ç”Ÿæˆå™¨ï¼‰ | com.sangfor.cpq.scene.generator | sf-support-service | æ ¹æ®è®¡ç®—ç»“æœç”Ÿæˆç‰©æ–™æ¸…å• | å„è®¡ç®—å™¨è¾“å‡º | ç‰©æ–™æ¸…å• | ProductService |
| 7 | PriceCalculatorï¼ˆä»·æ ¼è®¡ç®—å™¨ï¼‰ | com.sangfor.cpq.price.calculator | sf-support-service | è®¡ç®—ç‰©æ–™æ€»ä»· | ç‰©æ–™æ¸…å• | æ€»é‡‘é¢ | PricingServiceï¼ˆå¤–éƒ¨RPCï¼‰ |

### 4.2 ç¼–æ’æµç¨‹å›¾

```
å¼€å§‹
 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å‚æ•°æ ¡éªŒ      â”‚
â”‚ ParameterValidator â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ æ ¡éªŒé€šè¿‡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åœºæ™¯åŒ¹é…      â”‚
â”‚ SceneMatcher    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ è§„åˆ™åˆ—è¡¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. EPSè®¡ç®—       â”‚
â”‚ EpsCalculator   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ EPSå€¼
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ˜¾å¡è®¡ç®—      â”‚ â”‚ å¹¶è¡Œæ‰§è¡Œ         â”‚
â”‚ GraphicsCardCalcâ”‚ â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æœåŠ¡å™¨è®¡ç®—    â”‚
â”‚ ServerCalculatorâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ è®¡ç®—ç»“æœ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ç‰©æ–™ç”Ÿæˆ      â”‚
â”‚ MaterialGeneratorâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ ç‰©æ–™æ¸…å•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ä»·æ ¼è®¡ç®—      â”‚
â”‚ PriceCalculator â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ æ€»é‡‘é¢
       è¿”å›ç»“æœ
```

### 4.3 ç¼–æ’ä»£ç ç¤ºä¾‹

```java
/**
 * åœºæ™¯é€‰å‹ä¸»æµç¨‹ç¼–æ’
 * 
 * <p><b>åŒ…è·¯å¾„</b>ï¼šcom.sangfor.cpq.scene.service.impl.SceneSelectionService
 * <p><b>é¡¹ç›®ä½ç½®</b>ï¼šsf-support-serviceï¼ˆæœ¬é¡¹ç›®ï¼‰
 * 
 * <p><b>ç¼–æ’è¯´æ˜</b>ï¼š
 * æœ¬æ–¹æ³•è´Ÿè´£åè°ƒå„ä¸ªå­èƒ½åŠ›ï¼ˆå‚æ•°æ ¡éªŒã€åœºæ™¯åŒ¹é…ã€EPSè®¡ç®—ã€æ˜¾å¡è®¡ç®—ã€
 * æœåŠ¡å™¨è®¡ç®—ã€ç‰©æ–™ç”Ÿæˆã€ä»·æ ¼è®¡ç®—ï¼‰å®Œæˆåœºæ™¯é€‰å‹çš„å®Œæ•´æµç¨‹ã€‚
 */
public CalculationResult selectScene(SceneSelectionRequest request) {
    log.info("å¼€å§‹åœºæ™¯é€‰å‹è®¡ç®—ï¼Œè¯·æ±‚å‚æ•°ï¼š{}", request);
    
    // å‚æ•°æ ¡éªŒ
    if (request == null) {
        log.error("è¯·æ±‚å‚æ•°ä¸èƒ½ä¸ºç©º");
        throw new IllegalArgumentException("è¯·æ±‚å‚æ•°ä¸èƒ½ä¸ºç©º");
    }
    if (request.getIndustryCode() == null) {
        log.error("è¡Œä¸šä»£ç ä¸èƒ½ä¸ºç©º");
        throw new IllegalArgumentException("è¡Œä¸šä»£ç ä¸èƒ½ä¸ºç©º");
    }
    if (StringUtils.isBlank(request.getScenarioType())) {
        log.error("åœºæ™¯ç±»å‹ä¸èƒ½ä¸ºç©º");
        throw new IllegalArgumentException("åœºæ™¯ç±»å‹ä¸èƒ½ä¸ºç©º");
    }
    
    try {
        // æ­¥éª¤1ï¼šåœºæ™¯åŒ¹é…
        log.debug("æ­¥éª¤1ï¼šåœºæ™¯åŒ¹é…");
        List<SceneRule> rules = sceneMatcher.matchRules(
            request.getIndustryCode(), 
            request.getScenarioType()
        );
        
        // æ£€æŸ¥è§„åˆ™æ˜¯å¦åŒ¹é…
        if (CollectionUtils.isEmpty(rules)) {
            log.warn("æœªæ‰¾åˆ°åŒ¹é…çš„åœºæ™¯è§„åˆ™ï¼ŒindustryCode: {}, scenarioType: {}",
                request.getIndustryCode(), request.getScenarioType());
            throw new BusinessException("æœªæ‰¾åˆ°åŒ¹é…çš„åœºæ™¯è§„åˆ™");
        }
        
        // ========== æ­¥éª¤2ï¼šEPSè®¡ç®— ==========
        log.debug("æ­¥éª¤2ï¼šEPSè®¡ç®—");
        BigDecimal eps = epsCalculator.calculate(
            request.getUserInputParams(),
            rules.get(0) // ä½¿ç”¨ä¼˜å…ˆçº§æœ€é«˜çš„è§„åˆ™
        );
        log.info("EPSè®¡ç®—å®Œæˆï¼ŒEPSå€¼ï¼š{}", eps);
        
        // ========== æ­¥éª¤3ï¼šæ˜¾å¡è®¡ç®— ==========
        log.debug("æ­¥éª¤3ï¼šæ˜¾å¡è®¡ç®—");
        GraphicsCardResult cardResult = graphicsCardCalculator.calculate(
            eps, 
            rules, 
            request.getUserInputParams()
        );
        log.info("æ˜¾å¡è®¡ç®—å®Œæˆï¼Œæ˜¾å¡å‹å·ï¼š{}ï¼Œæ•°é‡ï¼š{}", 
            cardResult.getCardSpec(), cardResult.getCardCount());
        
        // ========== æ­¥éª¤4ï¼šæœåŠ¡å™¨è®¡ç®— ==========
        log.debug("æ­¥éª¤4ï¼šæœåŠ¡å™¨è®¡ç®—");
        ServerResult serverResult = serverCalculator.calculate(
            cardResult.getCardCount(),
            cardResult.getCardSpec(),
            rules
        );
        log.info("æœåŠ¡å™¨è®¡ç®—å®Œæˆï¼ŒæœåŠ¡å™¨æ•°é‡ï¼š{}", serverResult.getServerCount());
        
        // ========== æ­¥éª¤5ï¼šç‰©æ–™ç”Ÿæˆ ==========
        log.debug("æ­¥éª¤5ï¼šç‰©æ–™ç”Ÿæˆ");
        List<MaterialItem> materials = materialGenerator.generate(
            cardResult,
            serverResult,
            rules
        );
        log.info("ç‰©æ–™ç”Ÿæˆå®Œæˆï¼Œç‰©æ–™æ•°é‡ï¼š{}", materials.size());
        
        // ========== æ­¥éª¤6ï¼šä»·æ ¼è®¡ç®— ==========
        log.debug("æ­¥éª¤6ï¼šä»·æ ¼è®¡ç®—");
        BigDecimal totalAmount = priceCalculator.calculate(materials);
        log.info("ä»·æ ¼è®¡ç®—å®Œæˆï¼Œæ€»é‡‘é¢ï¼š{}", totalAmount);
        
        // ========== æ­¥éª¤7ï¼šæ„å»ºè¿”å›ç»“æœ ==========
        CalculationResult result = CalculationResult.builder()
            .success(true)
            .materialItems(materials)
            .totalAmount(totalAmount)
            .build();
        
        log.info("åœºæ™¯é€‰å‹è®¡ç®—å®Œæˆ");
        return result;
        
    } catch (IllegalArgumentException e) {
        log.error("å‚æ•°æ ¡éªŒå¤±è´¥ï¼š{}", e.getMessage());
        throw e;
    } catch (BusinessException e) {
        log.error("ä¸šåŠ¡å¤„ç†å¤±è´¥ï¼š{}", e.getMessage());
        throw e;
    } catch (Exception e) {
        log.error("ç³»ç»Ÿå¼‚å¸¸", e);
        throw new SystemException("åœºæ™¯é€‰å‹è®¡ç®—å¤±è´¥", e);
    }
}
```

### 4.4 å¼‚å¸¸å¤„ç†ç­–ç•¥

| æ­¥éª¤ | å¼‚å¸¸ç±»å‹ | å¤„ç†æ–¹å¼ | ç”¨æˆ·æç¤º |
|-----|---------|---------|---------|
| å‚æ•°æ ¡éªŒ | IllegalArgumentException | ç«‹å³è¿”å›ï¼Œä¸ç»§ç»­æ‰§è¡Œ | æç¤ºå…·ä½“å“ªä¸ªå‚æ•°ä¸åˆæ³• |
| åœºæ™¯åŒ¹é… | BusinessException | ç«‹å³è¿”å› | "å½“å‰åœºæ™¯æš‚ä¸æ”¯æŒ" |
| EPSè®¡ç®— | ArithmeticException | è®°å½•æ—¥å¿—ï¼Œä½¿ç”¨é»˜è®¤å€¼ | "è®¡ç®—å¼‚å¸¸ï¼Œå·²ä½¿ç”¨æ¨èå€¼" |
| æ˜¾å¡è®¡ç®— | BusinessException | è®°å½•æ—¥å¿—ï¼Œè½¬äººå·¥å¤„ç† | "é…ç½®å¤æ‚ï¼Œè¯·è”ç³»é”€å”®" |
| ç‰©æ–™ç”Ÿæˆ | NotFoundException | è®°å½•æ—¥å¿—ï¼Œè·³è¿‡è¯¥ç‰©æ–™ | "éƒ¨åˆ†ç‰©æ–™ç¼ºè´§" |
| ä»·æ ¼è®¡ç®— | SystemException | è®°å½•æ—¥å¿—ï¼Œè¿”å›é»˜è®¤ä»· | "ä»·æ ¼è®¡ç®—å¼‚å¸¸ï¼Œè¯·å’¨è¯¢" |

---

## 5ï¸âƒ£ ä¾èµ–å…³ç³»æ¾„æ¸…è§„èŒƒ

### æ ¸å¿ƒåŸåˆ™
> **æ˜ç¡®å¯¹å·²æœ‰åŠŸèƒ½ã€å¤–éƒ¨æ¥å£ã€ä¸­é—´ä»¶çš„ä¾èµ–ï¼Œå¹¶ç¼–æ’è¿›ä¸šåŠ¡æµç¨‹**

### 5.1 å†…éƒ¨ä¾èµ–æ¸…å•

#### Serviceå±‚ä¾èµ–

| ä¾èµ–ç±»å‹ | ä¾èµ–é¡¹ | åŒ…è·¯å¾„ | é¡¹ç›®ä½ç½® | è¯´æ˜ | è°ƒç”¨æ—¶æœº | è°ƒç”¨æ–¹å¼ |
|---------|-------|-------|---------|------|---------|---------|
| Service | `ProductService` | com.sangfor.cpq.product.service | sf-support-service | æŸ¥è¯¢äº§å“ä¿¡æ¯å’Œä»·æ ¼ | ç‰©æ–™ç”Ÿæˆé˜¶æ®µ | `@Autowired` æ³¨å…¥ |
| Service | `CustomerService` | com.sangfor.cpq.customer.service | sf-support-service | æŸ¥è¯¢å®¢æˆ·è¡Œä¸šä¿¡æ¯ | å‚æ•°æ ¡éªŒé˜¶æ®µ | `@Autowired` æ³¨å…¥ |
| Service | `QuoteService` | com.sangfor.cpq.quote.service | sf-support-service | åˆ›å»ºæŠ¥ä»·å• | ç»“æœä¿å­˜é˜¶æ®µ | `@Autowired` æ³¨å…¥ |

**è°ƒç”¨ç¤ºä¾‹**ï¼š
```java
/**
 * åœºæ™¯é€‰å‹æœåŠ¡å®ç°
 * 
 * <p><b>åŒ…è·¯å¾„</b>ï¼šcom.sangfor.cpq.scene.service.impl.SceneSelectionService
 * <p><b>é¡¹ç›®ä½ç½®</b>ï¼šsf-support-serviceï¼ˆæœ¬é¡¹ç›®ï¼‰
 */
@Service
@Slf4j
public class SceneSelectionService {
    
    @Autowired
    private ProductService productService;
    
    @Autowired
    private CustomerService customerService;
    
    /**
     * æŸ¥è¯¢å®¢æˆ·è¡Œä¸šä¿¡æ¯
     */
    private Integer getCustomerIndustryCode(Long customerId) {
        // å‚æ•°æ ¡éªŒ
        if (customerId == null) {
            log.error("å®¢æˆ·IDä¸èƒ½ä¸ºç©º");
            throw new IllegalArgumentException("å®¢æˆ·IDä¸èƒ½ä¸ºç©º");
        }
        
        // æŸ¥è¯¢å®¢æˆ·ä¿¡æ¯
        CustomerInfo customer = customerService.getCustomerById(customerId);
        
        // ç»“æœæ ¡éªŒ
        if (customer == null) {
            log.error("å®¢æˆ·ä¸å­˜åœ¨ï¼ŒcustomerId: {}", customerId);
            throw new BusinessException("å®¢æˆ·ä¸å­˜åœ¨");
        }
        
        // è¿”å›è¡Œä¸šä»£ç 
        return customer.getIndustryCode();
    }
    
    /**
     * æŸ¥è¯¢äº§å“ä»·æ ¼å¹¶å¡«å……ç‰©æ–™æ¸…å•
     */
    private void enrichProductPrices(List<MaterialItem> materials) {
        // å‚æ•°æ ¡éªŒ
        if (CollectionUtils.isEmpty(materials)) {
            log.warn("ç‰©æ–™æ¸…å•ä¸ºç©ºï¼Œæ— éœ€æŸ¥è¯¢ä»·æ ¼");
            return;
        }
        
        // éå†ç‰©æ–™æŸ¥è¯¢ä»·æ ¼
        for (MaterialItem item : materials) {
            // æ£€æŸ¥äº§å“ç¼–ç 
            if (StringUtils.isBlank(item.getProductCode())) {
                log.warn("ç‰©æ–™çš„äº§å“ç¼–ç ä¸ºç©ºï¼Œè·³è¿‡ï¼š{}", item);
                continue;
            }
            
            // æŸ¥è¯¢äº§å“ä»·æ ¼
            ProductPrice price = productService.getProductPrice(
                item.getProductCode()
            );
            
            // æ£€æŸ¥ä»·æ ¼æ˜¯å¦å­˜åœ¨
            if (price == null || price.getPrice() == null) {
                log.warn("äº§å“ä»·æ ¼ä¸å­˜åœ¨ï¼ŒproductCode: {}", item.getProductCode());
                continue;
            }
            
            // å¡«å……ä»·æ ¼ä¿¡æ¯
            item.setUnitPrice(price.getPrice());
            item.setTotalPrice(
                price.getPrice().multiply(new BigDecimal(item.getQuantity()))
            );
        }
    }
}
```

#### Mapperå±‚ä¾èµ–

| ä¾èµ–é¡¹ | åŒ…è·¯å¾„ | é¡¹ç›®ä½ç½® | è¯´æ˜ | SQLæ“ä½œ |
|-------|-------|---------|------|---------|
| `SceneRuleMapper` | com.sangfor.cpq.scene.mapper | sf-support-service | æŸ¥è¯¢åœºæ™¯è§„åˆ™é…ç½® | SELECT |
| `MaterialMappingMapper` | com.sangfor.cpq.scene.mapper | sf-support-service | æŸ¥è¯¢ç‰©æ–™æ˜ å°„å…³ç³» | SELECT |

**è°ƒç”¨ç¤ºä¾‹**ï¼š
```java
/**
 * åœºæ™¯è§„åˆ™æŸ¥è¯¢æœåŠ¡
 * 
 * <p><b>åŒ…è·¯å¾„</b>ï¼šcom.sangfor.cpq.scene.service.impl.SceneRuleQueryService
 * <p><b>é¡¹ç›®ä½ç½®</b>ï¼šsf-support-serviceï¼ˆæœ¬é¡¹ç›®ï¼‰
 */
@Autowired
private SceneRuleMapper sceneRuleMapper;

/**
 * æŸ¥è¯¢åœºæ™¯è§„åˆ™
 */
private List<SceneRule> querySceneRules(Integer industryCode, String scenarioType) {
    // å‚æ•°æ ¡éªŒ
    if (industryCode == null) {
        log.error("è¡Œä¸šä»£ç ä¸èƒ½ä¸ºç©º");
        throw new IllegalArgumentException("è¡Œä¸šä»£ç ä¸èƒ½ä¸ºç©º");
    }
    if (StringUtils.isBlank(scenarioType)) {
        log.error("åœºæ™¯ç±»å‹ä¸èƒ½ä¸ºç©º");
        throw new IllegalArgumentException("åœºæ™¯ç±»å‹ä¸èƒ½ä¸ºç©º");
    }
    
    // æŸ¥è¯¢è§„åˆ™
    List<SceneRule> rules = sceneRuleMapper.selectByIndustryAndScenario(
        industryCode, 
        scenarioType
    );
    
    // æ£€æŸ¥ç»“æœ
    if (CollectionUtils.isEmpty(rules)) {
        log.warn("æœªæŸ¥è¯¢åˆ°åœºæ™¯è§„åˆ™ï¼ŒindustryCode: {}, scenarioType: {}", 
            industryCode, scenarioType);
        return Collections.emptyList();
    }
    
    // æŒ‰ä¼˜å…ˆçº§æ’åº
    rules.sort(Comparator.comparing(SceneRule::getPriority));
    
    return rules;
}
```

#### å·¥å…·ç±»ä¾èµ–

| å·¥å…·ç±» | åŒ…è·¯å¾„ | é¡¹ç›®ä½ç½® | è¯´æ˜ | å¸¸ç”¨æ–¹æ³• |
|-------|-------|---------|------|---------|
| `BigDecimalUtils` | com.sangfor.common.util | commonæ¨¡å— | BigDecimalè¿ç®—å·¥å…· | `add()`, `multiply()`, `divide()` |
| `DateUtils` | com.sangfor.common.util | commonæ¨¡å— | æ—¥æœŸå¤„ç†å·¥å…· | `format()`, `parse()` |
| `JsonUtils` | com.sangfor.common.util | commonæ¨¡å— | JSONåºåˆ—åŒ–å·¥å…· | `toJson()`, `fromJson()` |

**è°ƒç”¨ç¤ºä¾‹**ï¼š
```java
/**
 * ä»·æ ¼è®¡ç®—æœåŠ¡
 * 
 * <p><b>åŒ…è·¯å¾„</b>ï¼šcom.sangfor.cpq.price.service.impl.PriceCalculationService
 * <p><b>é¡¹ç›®ä½ç½®</b>ï¼šsf-support-serviceï¼ˆæœ¬é¡¹ç›®ï¼‰
 */

/**
 * è®¡ç®—ç‰©æ–™æ€»ä»·
 */
public BigDecimal calculateTotalPrice(List<MaterialItem> materials) {
    // å‚æ•°æ ¡éªŒ
    if (CollectionUtils.isEmpty(materials)) {
        log.warn("ç‰©æ–™æ¸…å•ä¸ºç©º");
        return BigDecimal.ZERO;
    }
    
    // ä½¿ç”¨BigDecimalUtilsè¿›è¡Œå®‰å…¨è¿ç®—
    BigDecimal total = BigDecimal.ZERO;
    for (MaterialItem item : materials) {
        // æ£€æŸ¥å•ä»·å’Œæ•°é‡
        if (item.getUnitPrice() == null || item.getQuantity() == null) {
            log.warn("ç‰©æ–™ä»·æ ¼æˆ–æ•°é‡ä¸ºç©ºï¼Œè·³è¿‡ï¼š{}", item);
            continue;
        }
        
        BigDecimal itemTotal = BigDecimalUtils.multiply(
            item.getUnitPrice(), 
            new BigDecimal(item.getQuantity())
        );
        total = BigDecimalUtils.add(total, itemTotal);
    }
    
    return total;
}

/**
 * è§£æè§„åˆ™è¡¨è¾¾å¼
 */
private Map<String, Object> parseRuleExpression(SceneRule rule) {
    // å‚æ•°æ ¡éªŒ
    if (rule == null) {
        log.error("è§„åˆ™å¯¹è±¡ä¸èƒ½ä¸ºç©º");
        throw new IllegalArgumentException("è§„åˆ™å¯¹è±¡ä¸èƒ½ä¸ºç©º");
    }
    if (StringUtils.isBlank(rule.getRuleExpression())) {
        log.error("è§„åˆ™è¡¨è¾¾å¼ä¸èƒ½ä¸ºç©ºï¼ŒruleCode: {}", rule.getRuleCode());
        throw new BusinessException("è§„åˆ™è¡¨è¾¾å¼ä¸èƒ½ä¸ºç©º");
    }
    
    // ä½¿ç”¨JsonUtilsè§£æJSON
    try {
        Map<String, Object> ruleExpr = JsonUtils.fromJson(
            rule.getRuleExpression(), 
            new TypeReference<Map<String, Object>>() {}
        );
        
        // æ£€æŸ¥è§£æç»“æœ
        if (ruleExpr == null || ruleExpr.isEmpty()) {
            log.warn("è§„åˆ™è¡¨è¾¾å¼è§£æä¸ºç©ºï¼ŒruleCode: {}", rule.getRuleCode());
            return Collections.emptyMap();
        }
        
        return ruleExpr;
        
    } catch (Exception e) {
        log.error("è§„åˆ™è¡¨è¾¾å¼è§£æå¤±è´¥ï¼ŒruleCode: {}, expression: {}", 
            rule.getRuleCode(), rule.getRuleExpression(), e);
        throw new BusinessException("è§„åˆ™è¡¨è¾¾å¼æ ¼å¼é”™è¯¯", e);
    }
}
```

### 5.2 å¤–éƒ¨æ¥å£ä¾èµ–

#### HTTP APIä¾èµ–

| æ¥å£åç§° | æä¾›æ–¹ | æ¥å£åœ°å€ | è¯·æ±‚æ–¹å¼ | é¡¹ç›®ä½ç½® | è¯´æ˜ | è°ƒç”¨æ—¶æœº |
|---------|-------|---------|---------|---------|------|---------|
| äº§å“ä¸»æ•°æ®æŸ¥è¯¢ | MDMç³»ç»Ÿï¼ˆå¤–éƒ¨ï¼‰ | `/api/mdm/product/query` | GET | å¤–éƒ¨ç³»ç»Ÿ | æŸ¥è¯¢äº§å“ä¸»æ•°æ® | ç‰©æ–™ç”Ÿæˆé˜¶æ®µ |
| åº“å­˜æŸ¥è¯¢ | WMSç³»ç»Ÿï¼ˆå¤–éƒ¨ï¼‰ | `/api/wms/inventory/check` | POST | å¤–éƒ¨ç³»ç»Ÿ | æ£€æŸ¥åº“å­˜å¯ç”¨æ€§ | ç‰©æ–™éªŒè¯é˜¶æ®µ |

**è°ƒç”¨ç¤ºä¾‹**ï¼š
```java
/**
 * å¤–éƒ¨APIé…ç½®ç±»
 * 
 * <p><b>åŒ…è·¯å¾„</b>ï¼šcom.sangfor.cpq.config.ExternalApiConfig
 * <p><b>é¡¹ç›®ä½ç½®</b>ï¼šsf-support-serviceï¼ˆæœ¬é¡¹ç›®ï¼‰
 */
@Configuration
public class ExternalApiConfig {
    
    @Value("${external.mdm.base-url}")
    private String mdmBaseUrl;
    
    @Bean
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
}

/**
 * MDMç³»ç»Ÿæ¥å£æœåŠ¡
 * 
 * <p><b>åŒ…è·¯å¾„</b>ï¼šcom.sangfor.cpq.external.service.MdmService
 * <p><b>é¡¹ç›®ä½ç½®</b>ï¼šsf-support-serviceï¼ˆæœ¬é¡¹ç›®ï¼‰
 */
@Service
@Slf4j
public class MdmService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    @Value("${external.mdm.base-url}")
    private String mdmBaseUrl;
    
    /**
     * æŸ¥è¯¢äº§å“ä¸»æ•°æ®
     */
    public ProductMasterData queryProductMasterData(String productCode) {
        // å‚æ•°æ ¡éªŒ
        if (StringUtils.isBlank(productCode)) {
            log.error("äº§å“ç¼–ç ä¸èƒ½ä¸ºç©º");
            throw new IllegalArgumentException("äº§å“ç¼–ç ä¸èƒ½ä¸ºç©º");
        }
        
        // æ„å»ºè¯·æ±‚URL
        String url = mdmBaseUrl + "/api/mdm/product/query?productCode=" + productCode;
        
        try {
            // è°ƒç”¨å¤–éƒ¨æ¥å£
            ProductResponse response = restTemplate.getForObject(url, ProductResponse.class);
            
            // æ£€æŸ¥å“åº”
            if (response == null) {
                log.error("MDMæ¥å£è¿”å›ç»“æœä¸ºç©ºï¼ŒproductCode: {}", productCode);
                throw new BusinessException("MDMç³»ç»Ÿæ— å“åº”");
            }
            if (!response.isSuccess()) {
                log.error("MDMæ¥å£è°ƒç”¨å¤±è´¥ï¼ŒproductCode: {}, errorMsg: {}", 
                    productCode, response.getMessage());
                throw new BusinessException("æŸ¥è¯¢äº§å“ä¸»æ•°æ®å¤±è´¥ï¼š" + response.getMessage());
            }
            if (response.getData() == null) {
                log.warn("äº§å“ä¸»æ•°æ®ä¸å­˜åœ¨ï¼ŒproductCode: {}", productCode);
                throw new NotFoundException("äº§å“ä¸å­˜åœ¨");
            }
            
            // è¿”å›ç»“æœ
            return response.getData();
            
        } catch (RestClientException e) {
            log.error("è°ƒç”¨MDMæ¥å£å¼‚å¸¸ï¼ŒproductCode: {}, url: {}", productCode, url, e);
            throw new SystemException("MDMç³»ç»Ÿè°ƒç”¨å¤±è´¥", e);
        }
    }
}
```

#### RPCæ¥å£ä¾èµ–

| æ¥å£åç§° | æä¾›æ–¹ | æ¥å£å®šä¹‰ | é¡¹ç›®ä½ç½® | è¯´æ˜ | è°ƒç”¨æ—¶æœº |
|---------|-------|---------|---------|------|---------|
| ä»·æ ¼è®¡ç®—æœåŠ¡ | å®šä»·ä¸­å¿ƒï¼ˆå¤–éƒ¨ï¼‰ | `PricingService.calculatePrice()` | å¤–éƒ¨RPCæœåŠ¡ | è®¡ç®—æŠ˜æ‰£ä»·æ ¼ | ä»·æ ¼è®¡ç®—é˜¶æ®µ |
| ä¿¡ç”¨æ£€æŸ¥æœåŠ¡ | é£æ§ç³»ç»Ÿï¼ˆå¤–éƒ¨ï¼‰ | `CreditService.checkCredit()` | å¤–éƒ¨RPCæœåŠ¡ | æ£€æŸ¥å®¢æˆ·ä¿¡ç”¨ | è®¢å•åˆ›å»ºå‰ |

**è°ƒç”¨ç¤ºä¾‹**ï¼š
```java
@Service
@Slf4j
public class PriceService {
    
    @DubboReference
    private PricingService pricingService;
    
    /**
     * è®¡ç®—æŠ˜æ‰£ä»·æ ¼
     */
    public BigDecimal calculateDiscountPrice(List<MaterialItem> materials, Long customerId) {
        PriceRequest request = new PriceRequest();
        request.setMaterials(materials);
        request.setCustomerId(customerId);
        
        try {
            PriceResponse response = pricingService.calculatePrice(request);
            
            if (!response.isSuccess()) {
                throw new BusinessException("ä»·æ ¼è®¡ç®—å¤±è´¥ï¼š" + response.getMessage());
            }
            
            return response.getTotalAmount();
            
        } catch (RpcException e) {
            log.error("è°ƒç”¨å®šä»·ä¸­å¿ƒRPCå¤±è´¥", e);
            throw new SystemException("å®šä»·æœåŠ¡è°ƒç”¨å¤±è´¥", e);
        }
    }
}
```

### 5.3 ä¸­é—´ä»¶ä¾èµ–

#### Redisç¼“å­˜

| ç”¨é€” | Keyæ ¼å¼ | è¿‡æœŸæ—¶é—´ | è¯´æ˜ |
|-----|--------|---------|------|
| ç¼“å­˜åœºæ™¯è§„åˆ™ | `scene:rule:{industryCode}:{scenarioType}` | 1å°æ—¶ | å‡å°‘æ•°æ®åº“æŸ¥è¯¢ |
| ç¼“å­˜äº§å“ä»·æ ¼ | `product:price:{productCode}` | 10åˆ†é’Ÿ | ä»·æ ¼å˜åŠ¨è¾ƒå¿« |
| è®¡ç®—ç»“æœç¼“å­˜ | `calculation:result:{requestHash}` | 5åˆ†é’Ÿ | ç›¸åŒè¯·æ±‚ç›´æ¥è¿”å› |

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@Service
@Slf4j
public class SceneRuleCacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private SceneRuleMapper sceneRuleMapper;
    
    /**
     * å¸¦ç¼“å­˜çš„è§„åˆ™æŸ¥è¯¢
     */
    public List<SceneRule> getRulesWithCache(Integer industryCode, String scenarioType) {
        String cacheKey = String.format("scene:rule:%d:%s", industryCode, scenarioType);
        
        // 1. å°è¯•ä»ç¼“å­˜è·å–
        List<SceneRule> rules = (List<SceneRule>) redisTemplate.opsForValue().get(cacheKey);
        
        if (CollectionUtils.isNotEmpty(rules)) {
            log.debug("ä»ç¼“å­˜è·å–è§„åˆ™ï¼Œå‘½ä¸­ç¼“å­˜");
            return rules;
        }
        
        // 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
        log.debug("ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“æŸ¥è¯¢è§„åˆ™");
        rules = sceneRuleMapper.selectByIndustryAndScenario(industryCode, scenarioType);
        
        // 3. å†™å…¥ç¼“å­˜
        if (CollectionUtils.isNotEmpty(rules)) {
            redisTemplate.opsForValue().set(cacheKey, rules, 1, TimeUnit.HOURS);
            log.debug("è§„åˆ™å·²ç¼“å­˜");
        }
        
        return rules;
    }
    
    /**
     * æ¸…é™¤è§„åˆ™ç¼“å­˜
     */
    public void evictRuleCache(Integer industryCode, String scenarioType) {
        String cacheKey = String.format("scene:rule:%d:%s", industryCode, scenarioType);
        redisTemplate.delete(cacheKey);
        log.info("å·²æ¸…é™¤è§„åˆ™ç¼“å­˜ï¼š{}", cacheKey);
    }
}
```

#### RabbitMQæ¶ˆæ¯é˜Ÿåˆ—

| Exchange | Routing Key | é˜Ÿåˆ— | ç”¨é€” |
|---------|-------------|------|------|
| `scene.calculation.exchange` | `calculation.complete` | `scene.calculation.complete.queue` | è®¡ç®—å®Œæˆé€šçŸ¥ |
| `scene.calculation.exchange` | `calculation.error` | `scene.calculation.error.queue` | è®¡ç®—å¼‚å¸¸é€šçŸ¥ |

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@Configuration
public class RabbitMQConfig {
    
    @Bean
    public DirectExchange sceneCalculationExchange() {
        return new DirectExchange("scene.calculation.exchange", true, false);
    }
    
    @Bean
    public Queue calculationCompleteQueue() {
        return new Queue("scene.calculation.complete.queue", true);
    }
    
    @Bean
    public Binding calculationCompleteBinding() {
        return BindingBuilder
            .bind(calculationCompleteQueue())
            .to(sceneCalculationExchange())
            .with("calculation.complete");
    }
}

@Service
@Slf4j
public class CalculationMessageService {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    /**
     * å‘é€è®¡ç®—å®Œæˆæ¶ˆæ¯
     */
    public void sendCalculationCompleteMessage(String quoteId, CalculationResult result) {
        CalculationCompleteMessage message = new CalculationCompleteMessage();
        message.setQuoteId(quoteId);
        message.setMaterialCount(result.getMaterialItems().size());
        message.setTotalAmount(result.getTotalAmount());
        message.setTimestamp(LocalDateTime.now());
        
        try {
            rabbitTemplate.convertAndSend(
                "scene.calculation.exchange", 
                "calculation.complete", 
                message
            );
            log.info("å‘é€è®¡ç®—å®Œæˆæ¶ˆæ¯æˆåŠŸï¼ŒquoteId: {}", quoteId);
            
        } catch (AmqpException e) {
            log.error("å‘é€MQæ¶ˆæ¯å¤±è´¥ï¼ŒquoteId: {}", quoteId, e);
            // ä¸å½±å“ä¸»æµç¨‹ï¼Œå¼‚æ­¥é€šçŸ¥å¤±è´¥ä»…è®°å½•æ—¥å¿—
        }
    }
}
```

### 5.4 é…ç½®ä¾èµ–

#### é…ç½®é¡¹æ¸…å•

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ | é…ç½®æ–‡ä»¶ |
|-------|-----|--------|------|---------|
| `scene.calculation.eps.peak-factor` | Double | 2.0 | EPSè®¡ç®—å³°å€¼å› å­ | application.yml |
| `scene.calculation.cache.enabled` | Boolean | true | æ˜¯å¦å¯ç”¨è§„åˆ™ç¼“å­˜ | application.yml |
| `external.mdm.base-url` | String | - | MDMç³»ç»Ÿåœ°å€ï¼ˆå¿…å¡«ï¼‰ | application-{env}.yml |
| `external.pricing.timeout` | Integer | 5000 | å®šä»·æœåŠ¡è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰ | application.yml |

#### é…ç½®æ–‡ä»¶ç¤ºä¾‹

**application.yml**
```yaml
scene:
  calculation:
    eps:
      peak-factor: 2.0  # EPSå³°å€¼å› å­
    cache:
      enabled: true  # å¯ç”¨ç¼“å­˜
      ttl: 3600  # ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰

external:
  pricing:
    timeout: 5000  # RPCè¶…æ—¶æ—¶é—´
    retry-times: 3  # é‡è¯•æ¬¡æ•°
```

**application-sit.yml**
```yaml
external:
  mdm:
    base-url: http://mdm-sit.example.com
  wms:
    base-url: http://wms-sit.example.com
```

#### é…ç½®ä½¿ç”¨ç¤ºä¾‹

```java
@Configuration
@ConfigurationProperties(prefix = "scene.calculation")
@Data
public class SceneCalculationProperties {
    
    /**
     * EPSé…ç½®
     */
    private EpsConfig eps = new EpsConfig();
    
    /**
     * ç¼“å­˜é…ç½®
     */
    private CacheConfig cache = new CacheConfig();
    
    @Data
    public static class EpsConfig {
        /**
         * å³°å€¼å› å­
         */
        private Double peakFactor = 2.0;
    }
    
    @Data
    public static class CacheConfig {
        /**
         * æ˜¯å¦å¯ç”¨ç¼“å­˜
         */
        private Boolean enabled = true;
        
        /**
         * ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
         */
        private Integer ttl = 3600;
    }
}

@Service
@Slf4j
public class EpsCalculator {
    
    @Autowired
    private SceneCalculationProperties properties;
    
    public BigDecimal calculateEPS(int dailyLogVolume) {
        // ä½¿ç”¨é…ç½®çš„å³°å€¼å› å­
        double peakFactor = properties.getEps().getPeakFactor();
        
        log.debug("ä½¿ç”¨å³°å€¼å› å­ï¼š{}", peakFactor);
        
        // è®¡ç®—é€»è¾‘
        // ...
    }
}
```

### 5.5 å®Œæ•´æµç¨‹ä¸­çš„ä¾èµ–ç¼–æ’

```java
@Service
@Slf4j
public class SceneSelectionFacade {
    
    // ========== å†…éƒ¨ä¾èµ– ==========
    @Autowired
    private CustomerService customerService;
    
    @Autowired
    private SceneRuleCacheService sceneRuleCacheService;
    
    @Autowired
    private EpsCalculator epsCalculator;
    
    @Autowired
    private GraphicsCardCalculator graphicsCardCalculator;
    
    @Autowired
    private ServerCalculator serverCalculator;
    
    @Autowired
    private MaterialGenerator materialGenerator;
    
    // ========== å¤–éƒ¨ä¾èµ– ==========
    @Autowired
    private MdmService mdmService;
    
    @DubboReference
    private PricingService pricingService;
    
    // ========== ä¸­é—´ä»¶ä¾èµ– ==========
    @Autowired
    private CalculationMessageService messageService;
    
    // ========== é…ç½®ä¾èµ– ==========
    @Autowired
    private SceneCalculationProperties properties;
    
    /**
     * åœºæ™¯é€‰å‹ä¸»æµç¨‹ï¼ˆåŒ…å«æ‰€æœ‰ä¾èµ–çš„ç¼–æ’ï¼‰
     */
    public CalculationResult selectScene(SceneSelectionRequest request) {
        log.info("å¼€å§‹åœºæ™¯é€‰å‹ï¼Œè¯·æ±‚å‚æ•°ï¼š{}", request);
        
        // 1. æŸ¥è¯¢å®¢æˆ·ä¿¡æ¯ï¼ˆå†…éƒ¨ä¾èµ–ï¼šCustomerServiceï¼‰
        CustomerInfo customer = customerService.getCustomerById(request.getCustomerId());
        Integer industryCode = customer.getIndustryCode();
        
        // 2. æŸ¥è¯¢åœºæ™¯è§„åˆ™ï¼ˆå†…éƒ¨ä¾èµ–ï¼šMapper + Redisç¼“å­˜ï¼‰
        List<SceneRule> rules = sceneRuleCacheService.getRulesWithCache(
            industryCode, 
            request.getScenarioType()
        );
        
        // 3. æ‰§è¡Œè®¡ç®—ï¼ˆå†…éƒ¨èƒ½åŠ›ç¼–æ’ï¼‰
        BigDecimal eps = epsCalculator.calculate(request.getUserInputParams(), rules);
        GraphicsCardResult cardResult = graphicsCardCalculator.calculate(eps, rules);
        ServerResult serverResult = serverCalculator.calculate(cardResult, rules);
        List<MaterialItem> materials = materialGenerator.generate(cardResult, serverResult, rules);
        
        // 4. æŸ¥è¯¢äº§å“ä¸»æ•°æ®ï¼ˆå¤–éƒ¨ä¾èµ–ï¼šMDMç³»ç»Ÿï¼‰
        for (MaterialItem item : materials) {
            ProductMasterData masterData = mdmService.queryProductMasterData(item.getProductCode());
            item.setProductName(masterData.getProductName());
        }
        
        // 5. è®¡ç®—æŠ˜æ‰£ä»·æ ¼ï¼ˆå¤–éƒ¨ä¾èµ–ï¼šå®šä»·ä¸­å¿ƒRPCï¼‰
        PriceRequest priceRequest = new PriceRequest();
        priceRequest.setMaterials(materials);
        priceRequest.setCustomerId(customer.getId());
        PriceResponse priceResponse = pricingService.calculatePrice(priceRequest);
        BigDecimal totalAmount = priceResponse.getTotalAmount();
        
        // 6. æ„å»ºè¿”å›ç»“æœ
        CalculationResult result = CalculationResult.builder()
            .success(true)
            .materialItems(materials)
            .totalAmount(totalAmount)
            .build();
        
        // 7. å‘é€å®Œæˆé€šçŸ¥ï¼ˆä¸­é—´ä»¶ä¾èµ–ï¼šRabbitMQï¼‰
        messageService.sendCalculationCompleteMessage(request.getQuoteId(), result);
        
        log.info("åœºæ™¯é€‰å‹å®Œæˆï¼Œç‰©æ–™æ•°é‡ï¼š{}ï¼Œæ€»é‡‘é¢ï¼š{}", materials.size(), totalAmount);
        return result;
    }
}
```

---

## 6ï¸âƒ£ ä¿ç•™åŸæœ‰æ–‡æ¡£ç»“æ„

### æ ¸å¿ƒåŸåˆ™
> **åœ¨åŸæœ‰æ‹†åˆ†æ€è·¯çš„åŸºç¡€ä¸Šï¼Œè¡¥å……ä¸Šè¿°5é¡¹å†…å®¹ï¼Œä¸ç ´åç°æœ‰è§„èŒƒ**

### 6.1 ä¸»æ–¹æ¡ˆç»“æ„æ¨¡æ¿

```markdown
# AIå®‰å…¨åœºæ™¯é€‰å‹-ä¸»æ–¹æ¡ˆ

## ğŸ“‘ æ–‡æ¡£ç´¢å¼•
- [å­æ–¹æ¡ˆ1ï¼šEPSè®¡ç®—å™¨](./EPSè®¡ç®—å™¨-å®ç°è®¾è®¡.md)
- [å­æ–¹æ¡ˆ2ï¼šæ˜¾å¡è®¡ç®—å™¨](./æ˜¾å¡è®¡ç®—å™¨-å®ç°è®¾è®¡.md)
- [å­æ–¹æ¡ˆ3ï¼šæœåŠ¡å™¨è®¡ç®—å™¨](./æœåŠ¡å™¨è®¡ç®—å™¨-å®ç°è®¾è®¡.md)

## ğŸ¯ 1. æ ¸å¿ƒç¼–æ’é€»è¾‘ï¼ˆåŸæœ‰å†…å®¹ä¿ç•™ï¼‰
### 1.1 ç³»ç»Ÿæ•´ä½“æ¶æ„å›¾
### 1.2 æ ¸å¿ƒæµç¨‹å›¾æˆ–æ—¶åºå›¾
### 1.3 å…³é”®è§’è‰²è¯†åˆ«å’ŒèŒè´£è¯´æ˜
### 1.4 ä¸»è¦æ•°æ®æµå‘

## ğŸ”Œ 2. æ¥å£å®šä¹‰ï¼ˆæ–°å¢ï¼‰
### 2.1 å¯¹å¤–APIæ¥å£
### 2.2 Serviceæ¥å£
### 2.3 å†…éƒ¨æ¥å£

## ğŸ—„ï¸ 3. æ•°æ®åº“è¡¨å®šä¹‰ï¼ˆæ–°å¢ï¼‰
### 3.1 è¡¨ç»“æ„è¯´æ˜
### 3.2 ç´¢å¼•è®¾è®¡
### 3.3 è¡¨å…³ç³»å›¾

## ğŸ§© 4. èƒ½åŠ›åˆ†è§£ä¸ç¼–æ’ï¼ˆæ–°å¢ï¼‰
### 4.1 å­èƒ½åŠ›æ¸…å•
### 4.2 ç¼–æ’æµç¨‹å›¾
### 4.3 ç¼–æ’ä»£ç ç¤ºä¾‹

## ğŸ”— 5. ä¾èµ–å…³ç³»æ¾„æ¸…ï¼ˆæ–°å¢ï¼‰
### 5.1 å†…éƒ¨ä¾èµ–
### 5.2 å¤–éƒ¨æ¥å£ä¾èµ–
### 5.3 ä¸­é—´ä»¶ä¾èµ–
### 5.4 é…ç½®ä¾èµ–

## ğŸ“‹ 6. ä»£ç ç”Ÿæˆæ­¥éª¤ï¼ˆåŸæœ‰å†…å®¹ä¿ç•™ï¼‰
### 6.1 ç”Ÿæˆé¡ºåºå’Œä¾èµ–å…³ç³»
### 6.2 è¿›åº¦è·Ÿè¸ªè¡¨æ ¼
```

### 6.2 å­æ–¹æ¡ˆç»“æ„æ¨¡æ¿

```markdown
# EPSè®¡ç®—å™¨-å­æ–¹æ¡ˆ

## ğŸ”— ä¸ä¸»æ–¹æ¡ˆçš„å…³è”ï¼ˆåŸæœ‰å†…å®¹ä¿ç•™ï¼‰
æœ¬æ–¹æ¡ˆè¯¦ç»†è®¾è®¡ã€EPSè®¡ç®—å™¨ã€‘ï¼Œå¯¹åº”ä¸»æµç¨‹ä¸­çš„ã€æ­¥éª¤3ï¼šè®¡ç®—EPSã€‘

## ğŸ“¥ è¾“å…¥ä¾èµ–ï¼ˆåŸæœ‰å†…å®¹ä¿ç•™ï¼‰
- ä¾èµ–ä¸»æ–¹æ¡ˆä¸­çš„ã€ç”¨æˆ·è¾“å…¥å‚æ•°ã€‘
- ä¾èµ–ã€åœºæ™¯è§„åˆ™é…ç½®ã€‘

## ğŸ“¤ è¾“å‡ºäº¤ä»˜ï¼ˆåŸæœ‰å†…å®¹ä¿ç•™ï¼‰
- è¾“å‡ºã€EPSå€¼ã€‘ç»™æ˜¾å¡è®¡ç®—å™¨å’ŒæœåŠ¡å™¨è®¡ç®—å™¨

## ğŸ¯ è¯¦ç»†å®ç°

### 1. ç±»è®¾è®¡ï¼ˆåŸæœ‰å†…å®¹ï¼‰

### 2. ç±»æ³¨é‡Šï¼ˆå¢å¼ºï¼šæ–°å¢ä½¿ç”¨ç¤ºä¾‹ï¼‰
/**
 * EPSè®¡ç®—å™¨
 * 
 * <p>ä½¿ç”¨ç¤ºä¾‹ï¼š
 * <pre>{@code
 * EpsCalculator calculator = new EpsCalculator();
 * BigDecimal eps = calculator.calculate(500, 2.0);
 * }</pre>
 */

### 3. æ–¹æ³•å®šä¹‰ï¼ˆåŸæœ‰å†…å®¹ï¼‰

### 4. æ–¹æ³•æ³¨é‡Šï¼ˆå¢å¼ºï¼šæ–°å¢ä½¿ç”¨ç¤ºä¾‹ï¼‰
/**
 * è®¡ç®—EPS
 * 
 * <p>ä½¿ç”¨ç¤ºä¾‹ï¼š
 * <pre>{@code
 * // ç¤ºä¾‹1ï¼šåŸºç¡€ç”¨æ³•
 * BigDecimal eps = calculateEPS(500, 2.0);
 * // ç»“æœï¼šçº¦5800 EPS
 * }</pre>
 */

### 5. è®¡ç®—é€»è¾‘ï¼ˆåŸæœ‰å†…å®¹ï¼‰

### 6. å¼‚å¸¸å¤„ç†ï¼ˆåŸæœ‰å†…å®¹ï¼‰

### 7. å•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼ˆåŸæœ‰å†…å®¹ï¼‰
```

---

## âœ… ä½¿ç”¨æ£€æŸ¥æ¸…å•

åœ¨ç¼–å†™å®ç°è®¾è®¡æ–‡æ¡£æ—¶ï¼Œè¯·ç¡®ä¿ä»¥ä¸‹å†…å®¹å®Œæ•´ï¼š

### ä¸»æ–¹æ¡ˆæ£€æŸ¥æ¸…å•

- [ ] **æ¥å£å®šä¹‰**ï¼šæ˜¯å¦å®šä¹‰äº†æ‰€æœ‰å¯¹å¤–æ¥å£çš„å…¥å‚ã€å‡ºå‚ã€å¼‚å¸¸ï¼Ÿ
- [ ] **æ•°æ®åº“è¡¨**ï¼šæ˜¯å¦å®šä¹‰äº†è¡¨ç»“æ„ã€ç´¢å¼•ã€DDLï¼Ÿ
- [ ] **èƒ½åŠ›åˆ†è§£**ï¼šæ˜¯å¦åˆ—å‡ºäº†å­èƒ½åŠ›æ¸…å•å’Œç¼–æ’æµç¨‹ï¼Ÿ
- [ ] **åŒ…è·¯å¾„å’Œé¡¹ç›®ä½ç½®**ï¼ˆâš ï¸æ–°å¢å¿…éœ€ï¼‰ï¼šèƒ½åŠ›æ¸…å•è¡¨æ ¼æ˜¯å¦åŒ…å«äº†åŒ…è·¯å¾„å’Œé¡¹ç›®ä½ç½®åˆ—ï¼Ÿ
- [ ] **ä¾èµ–æ¾„æ¸…**ï¼šæ˜¯å¦æ˜ç¡®äº†å†…éƒ¨ä¾èµ–ã€å¤–éƒ¨æ¥å£ã€ä¸­é—´ä»¶ã€é…ç½®ï¼Ÿ
- [ ] **ä¾èµ–è¡¨æ ¼å®Œæ•´æ€§**ï¼ˆâš ï¸æ–°å¢å¿…éœ€ï¼‰ï¼šä¾èµ–è¡¨æ ¼æ˜¯å¦åŒ…å«äº†åŒ…è·¯å¾„å’Œé¡¹ç›®ä½ç½®åˆ—ï¼Ÿ
- [ ] **æ ¸å¿ƒç¼–æ’**ï¼šæ˜¯å¦åŒ…å«æµç¨‹å›¾å’Œç¼–æ’ä»£ç ç¤ºä¾‹ï¼Ÿ
- [ ] **ä»£ç æ­¥éª¤**ï¼šæ˜¯å¦å®šä¹‰äº†ä»£ç ç”Ÿæˆçš„é¡ºåºå’Œä¾èµ–å…³ç³»ï¼Ÿ

### å­æ–¹æ¡ˆæ£€æŸ¥æ¸…å•

- [ ] **ä¸ä¸»æ–¹æ¡ˆå…³è”**ï¼šæ˜¯å¦è¯´æ˜äº†åœ¨ä¸»æµç¨‹ä¸­çš„ä½ç½®ï¼Ÿ
- [ ] **è¾“å…¥ä¾èµ–**ï¼šæ˜¯å¦æ˜ç¡®äº†ä¾èµ–çš„ä¸Šæ¸¸è¾“å‡ºï¼Ÿ
- [ ] **è¾“å‡ºäº¤ä»˜**ï¼šæ˜¯å¦è¯´æ˜äº†è¾“å‡ºå°†è¢«è°ä½¿ç”¨ï¼Ÿ
- [ ] **ç±»æ³¨é‡Š**ï¼šæ˜¯å¦åŒ…å«äº†å¯è¿è¡Œçš„ä½¿ç”¨ç¤ºä¾‹ï¼Ÿ
- [ ] **åŒ…è·¯å¾„å’Œé¡¹ç›®ä½ç½®**ï¼ˆâš ï¸æ–°å¢å¿…éœ€ï¼‰ï¼šç±»æ³¨é‡Šæ˜¯å¦åŒ…å«äº†åŒ…è·¯å¾„å’Œé¡¹ç›®ä½ç½®è¯´æ˜ï¼Ÿ
- [ ] **æ–¹æ³•æ³¨é‡Š**ï¼šæ˜¯å¦åŒ…å«äº†è‡³å°‘1ä¸ªä½¿ç”¨ç¤ºä¾‹ï¼Ÿ
- [ ] **è¯¦ç»†å®ç°**ï¼šæ˜¯å¦åŒ…å«äº†è®¡ç®—é€»è¾‘ã€å¼‚å¸¸å¤„ç†ï¼Ÿ
- [ ] **å«è¯­å¥ä½¿ç”¨**ï¼ˆâš ï¸æ–°å¢å»ºè®®ï¼‰ï¼šæ–¹æ³•å®ç°æ˜¯å¦ä½¿ç”¨äº†å«è¯­å¥å‡å°‘åµŒå¥—ï¼Ÿ

### ä»£ç ç¤ºä¾‹æ£€æŸ¥æ¸…å•

- [ ] **å¯è¿è¡Œæ€§**ï¼šç¤ºä¾‹ä»£ç æ˜¯å¦å¯ä»¥ç›´æ¥è¿è¡Œï¼Ÿ
- [ ] **å®Œæ•´æ€§**ï¼šæ˜¯å¦åŒ…å«äº†å¿…è¦çš„importã€å˜é‡å£°æ˜ï¼Ÿ
- [ ] **çœŸå®æ€§**ï¼šç¤ºä¾‹æ˜¯å¦åŸºäºçœŸå®çš„ä¸šåŠ¡åœºæ™¯ï¼Ÿ
- [ ] **æ¸…æ™°æ€§**ï¼šç¤ºä¾‹æ˜¯å¦æ˜“äºç†è§£ï¼Ÿ
- [ ] **åŒ…è·¯å¾„æ ‡æ³¨**ï¼ˆâš ï¸æ–°å¢å¿…éœ€ï¼‰ï¼šæ¯ä¸ªç±»çš„æ³¨é‡Šæ˜¯å¦åŒ…å«äº†åŒ…è·¯å¾„å’Œé¡¹ç›®ä½ç½®ï¼Ÿ
- [ ] **å«è¯­å¥åº”ç”¨**ï¼ˆâš ï¸æ–°å¢å»ºè®®ï¼‰ï¼šä»£ç ç¤ºä¾‹æ˜¯å¦ä¼˜å…ˆä½¿ç”¨å«è¯­å¥å¤„ç†å¼‚å¸¸æƒ…å†µï¼Ÿ
- [ ] **ä»£ç æ‰å¹³åŒ–**ï¼ˆâš ï¸æ–°å¢å»ºè®®ï¼‰ï¼šä»£ç æ˜¯å¦é¿å…äº†è¶…è¿‡2å±‚çš„if-elseåµŒå¥—ï¼Ÿ

---

## ğŸ“Œ é‡è¦æé†’

1. **æ¥å£å®šä¹‰å¿…é¡»åŒ…å«å…¥å‚è¡¨æ ¼ã€å‡ºå‚è¡¨æ ¼ã€å¼‚å¸¸è¯´æ˜**
2. **ç±»/æ–¹æ³•æ³¨é‡Šå¿…é¡»åŒ…å«è‡³å°‘1ä¸ªå¯è¿è¡Œçš„ä½¿ç”¨ç¤ºä¾‹**
3. **æ•°æ®åº“è¡¨å¿…é¡»æä¾›å®Œæ•´çš„DDLå’Œç´¢å¼•å®šä¹‰**
4. **èƒ½åŠ›åˆ†è§£å¿…é¡»æä¾›ç¼–æ’æµç¨‹å›¾å’Œç¼–æ’ä»£ç **
5. **ä¾èµ–å…³ç³»å¿…é¡»åœ¨ä¸šåŠ¡æµç¨‹ä¸­ç¼–æ’å±•ç¤º**
6. **ä¿ç•™åŸæœ‰çš„æ–‡æ¡£æ‹†åˆ†ç»“æ„ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¡¥å……å†…å®¹**

