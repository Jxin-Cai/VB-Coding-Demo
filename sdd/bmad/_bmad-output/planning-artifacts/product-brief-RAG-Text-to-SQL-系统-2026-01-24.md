---
stepsCompleted: [1, 2, 3, 4, 5]
inputDocuments: 
  - doc/mvp-optimized.md
date: 2026-01-24
author: Jxin
---

# Product Brief: RAG Text-to-SQL 系统

## Executive Summary

RAG Text-to-SQL 系统是一款面向产品经理的智能 SQL 生成工具，通过自然语言对话自动生成精确的 SQL 查询语句。产品经理无需学习 SQL 语法，只需用日常语言描述数据需求，系统即可通过 RAG（检索增强生成）技术和 Agent 架构自动生成可执行的 SQL，实现数据导出的自助化。

---

## Core Vision

### Problem Statement

产品经理在日常工作中频繁需要导出和分析数据，但由于不懂 SQL 语法，不得不依赖开发团队协助。这种依赖导致：
- 产品经理等待数据时工作受阻
- 开发团队被频繁打断，影响核心开发工作
- 数据获取效率低下，影响产品决策速度

### Problem Impact

**对产品经理：**
- 无法快速验证数据假设
- 依赖他人导致工作节奏被打乱
- 临时数据需求难以快速满足

**对开发团队：**
- 重复性的 SQL 编写工作占用开发时间
- 工作流被频繁打断，影响深度工作

**对团队协作：**
- 沟通成本高，响应时间长
- 简单的数据查询变成跨团队协作任务

### Why Existing Solutions Fall Short

**传统 BI 工具：**
- 学习成本高，产品经理需要学习工具特定的查询语法
- 灵活性不足，无法应对特定的复杂查询需求
- 需要预先配置报表，临时查询困难

**直接学习 SQL：**
- 学习曲线陡峭，对非技术人员不友好
- 记忆成本高，不常用的语法容易遗忘
- 复杂查询（JOIN、子查询）门槛过高

### Proposed Solution

RAG Text-to-SQL 系统采用 Agent 架构，让产品经理通过自然语言对话即可获得所需数据：

1. **上传 DDL 文件** - 一次性上传数据库表结构
2. **自然语言对话** - 用日常语言描述数据需求
3. **智能 SQL 生成** - Agent 自动检索相关表结构并生成精确 SQL
4. **透明可解释** - 展示引用的表结构，用户清楚了解 SQL 生成依据

### Key Differentiators

1. **Agent 自主决策架构** ⭐
   - 不是简单的模板匹配，而是 LLM Agent 自主推理
   - 可自主决策何时调用向量检索，获取相关表结构
   - 适应复杂、灵活的查询需求

2. **双模式智能交互**
   - 自动识别用户意图：普通对话 vs SQL 生成
   - 无需手动切换模式，降低使用门槛
   - 支持多轮对话优化 SQL

3. **可解释性设计**
   - 明确展示引用了哪些表和字段
   - 用户可追溯 SQL 生成的依据
   - 增强信任度，降低使用顾虑

4. **基于 RAG 的精准检索**
   - 向量化存储 DDL，语义检索相关表结构
   - 避免将整个数据库 schema 塞入 Prompt
   - 提升生成质量和响应速度

---

## Target Users

### Primary Users

**产品经理 - 数据分析需求者**

**典型画像：李明，互联网公司产品经理**
- **背景**：负责某 SaaS 产品的功能迭代和用户增长
- **工作环境**：需要频繁分析用户行为数据、业务数据来验证假设和支持决策
- **技能水平**：精通产品设计和用户研究，但不具备 SQL 编程能力
- **核心痛点**：
  - 每天需要导出 3-5 次数据进行分析
  - 每次都要找开发写 SQL，等待时间从 10 分钟到几小时不等
  - 临时数据需求（如验证某个功能的使用情况）经常因为"不好意思麻烦开发"而放弃
  - 开发团队的响应速度直接影响产品决策进度

**成功愿景：**
- 需要数据时立即上手，5 分钟内完成数据导出
- 无需学习 SQL，用日常语言描述需求即可
- 开发团队不再被打断，专注核心开发工作
- 数据驱动的产品决策效率提升 10 倍

**使用场景：**
1. **日常分析**：查看昨日新增用户数、活跃情况
2. **功能验证**：验证新功能的使用情况和转化率
3. **临时需求**：快速导出某个用户群体的特征数据
4. **复杂查询**：多表关联查询（如用户-订单-商品数据）

### Secondary Users

**开发团队 - 间接受益者**

**典型画像：张伟，后端开发工程师**
- **背景**：负责核心业务功能开发和维护
- **当前困扰**：每天被产品经理打断 5-10 次写 SQL
- **期望改变**：产品经理自助完成数据导出，减少打断频率

**受益点：**
- 减少重复性 SQL 编写工作，节省 30%-50% 时间
- 工作流不被打断，提升深度工作效率
- 专注核心开发任务，提升工程质量

**数据管理员 - 潜在用户**
- **角色**：负责数据安全和权限管理
- **关注点**：确保产品经理只能访问授权的数据库和表
- **期望**：系统能够集成权限控制，避免数据泄露风险

### User Journey

**发现阶段：**
- 产品经理在团队内部分享会上听说这个工具
- 或通过开发团队推荐了解到系统

**初次使用：**
1. 上传数据库 DDL 文件（开发提供）
2. 系统自动解析表结构，展示可查询的表
3. 输入第一个自然语言查询："查看昨天新增的用户数"
4. 系统生成 SQL 并展示引用的表结构
5. **"Aha!" 时刻**：看到自己的需求被精准转换为 SQL

**日常使用：**
- 需要数据时打开系统
- 用自然语言描述需求（如"查看最近 7 天购买过商品 A 的用户"）
- 系统自动识别意图并生成 SQL
- 复制 SQL 到数据库工具执行，导出数据
- 多轮对话优化 SQL（如"再加上用户的注册时间"）

**长期价值：**
- 数据导出从"依赖开发"变为"自助完成"
- 数据分析工作效率显著提升
- 产品决策速度加快，迭代周期缩短
- 与开发团队的协作关系更健康

---

## Success Metrics

### User Success Metrics

**核心用户成功指标：**

1. **自助完成率**
   - **定义**：产品经理无需开发协助即可完成数据导出的比例
   - **目标**：≥ 80%
   - **衡量方法**：（自助完成的查询数 / 总查询数）× 100%
   - **成功标准**：产品经理从"依赖开发"转变为"自助完成"

2. **查询成功率**
   - **定义**：生成的 SQL 能够正确执行并返回预期数据的比例
   - **目标**：≥ 80%（MVP 验收标准）
   - **衡量方法**：（成功执行的 SQL 数 / 生成的 SQL 总数）× 100%
   - **成功标准**：用户信任系统生成的 SQL，无需频繁修正

3. **时间节省**
   - **定义**：相比找开发写 SQL，用户节省的平均时间
   - **目标**：从平均等待 30 分钟 → 5 分钟内完成
   - **衡量方法**：（旧流程时间 - 新流程时间）
   - **成功标准**：数据获取效率提升 6 倍

4. **使用频率**
   - **定义**：用户使用系统的频率
   - **目标**：活跃用户每周使用 ≥ 3 次
   - **衡量方法**：统计用户访问和查询生成次数
   - **成功标准**：系统成为日常工作的常用工具

5. **"Aha!" 时刻触达**
   - **定义**：首次使用时成功生成 SQL 并获得数据的用户比例
   - **目标**：≥ 90% 的新用户在首次使用时成功
   - **衡量方法**：首次使用成功用户数 / 新注册用户数
   - **成功标准**：用户快速体验到产品价值

### Business Objectives

**短期目标（3 个月）：**

1. **用户采纳**
   - 目标：10-20 个产品经理开始使用系统
   - 验证：解决方案的有效性和 RAG 技术的可行性

2. **开发团队效率提升**
   - 目标：开发团队每周减少 30%-50% 的 SQL 编写请求
   - 验证：间接受益者的认可和支持

3. **技术验证**
   - 目标：SQL 生成准确率 ≥ 80%，向量检索相关性 ≥ 85%
   - 验证：Agent 架构和 RAG 技术的技术可行性

**中期目标（6-12 个月）：**

1. **用户规模扩大**
   - 目标：50+ 产品经理日常使用
   - 扩展：覆盖多个产品线和团队

2. **功能增强**
   - 实现可选增强功能（SQL 语法验证、DDL 关系图可视化等）
   - 支持更多数据库类型和复杂查询场景

3. **团队协作效率**
   - 目标：产品决策周期缩短 30%
   - 验证：数据驱动决策的频率和质量提升

**长期目标（12+ 个月）：**

1. **企业级推广**
   - 覆盖公司所有产品经理和数据分析岗位
   - 成为数据自助查询的标准工具

2. **成本节约**
   - 开发团队工作效率提升，节省人力成本
   - 产品决策质量提升，降低试错成本

### Key Performance Indicators

**用户参与度 KPI：**
- **DAU/WAU**：日活/周活跃用户数
- **目标**：WAU ≥ 80%（每周至少使用一次）
- **查询量**：每周生成 SQL 数量
- **目标**：每用户每周平均 3-5 次查询

**产品质量 KPI：**
- **SQL 生成准确率**：≥ 80%
- **向量检索相关性**：≥ 85%
- **平均响应时间**：SQL 生成 < 3 秒，对话响应 < 2 秒
- **DDL 向量化速度**：< 5 秒/文件

**用户满意度 KPI：**
- **Net Promoter Score (NPS)**：目标 ≥ 50
- **用户反馈评分**：目标 ≥ 4.0/5.0
- **功能使用率**：核心功能（SQL 生成、文件管理）使用率 ≥ 90%

**业务影响 KPI：**
- **开发团队打断次数减少**：≥ 50%
- **数据查询响应时间**：从平均 30 分钟 → 5 分钟
- **用户留存率**：30 天留存率 ≥ 70%

**技术健康度 KPI：**
- **系统可用性**：≥ 99.5%
- **错误率**：< 2%
- **代码质量**：符合 DDD 分层架构，无明显代码坏味道

---

## MVP Scope

### Core Features

**必需核心功能：**

1. **DDL 文件管理模块**
   - ✅ **文件上传**：支持 `.sql` 文件上传
   - ✅ **DDL 解析**：自动解析表结构、字段、索引信息
   - ✅ **向量化存储**：将 DDL 信息转换为向量并存储到内存向量数据库（FAISS/Chroma）
   - ✅ **文件管理界面**：查看已上传文件列表、文件状态（解析成功/失败）、删除文件功能

2. **智能对话与 SQL 生成模块（核心）**
   - ✅ **双模式交互**：
     - 普通对话模式：与 LLM 自由对话，解答问题
     - SQL 生成模式：系统自动识别用户意图，触发 RAG 流程
   - ✅ **Agent 架构**：
     - LLM Agent 具备向量查询工具调用能力
     - Agent 自主决策何时调用向量检索，补充 DDL 上下文
     - Expert Persona：数据分析专家，精通各种数据库 SQL 语法
   - ✅ **RAG 流程**：
     - 自然语言输入 → 向量化查询
     - 检索相关 DDL 信息（表结构、字段信息）
     - 组合 DDL + 用户诉求 → 调用 LLM 生成 SQL
   - ✅ **可解释性**：
     - 展示生成的 SQL 语句
     - 标注引用了哪些表和字段
     - 用户可追溯 SQL 生成依据

3. **基础技术架构**
   - ✅ **前端**：Vue.js 3 + Element Plus/Ant Design Vue + Pinia + Vite
   - ✅ **后端**：Python 3.9+ + LangChain + LangGraph + sqlparse/sqlglot
   - ✅ **向量数据库**：内存向量库（FAISS/Chroma）
   - ✅ **LLM 集成**：GLM 模型（DeepSeek/通义千问）
   - ✅ **架构模式**：DDD 分层架构（Interface, Application, Domain, Infrastructure）

### Out of Scope for MVP

**MVP 阶段不包含（未来增强功能）：**

1. **高级 SQL 功能**
   - ❌ SQL 语法验证（静态分析引擎）
   - ❌ SQL 执行计划分析
   - ❌ SQL 性能优化建议
   - ❌ SQL 执行和结果预览（直接在系统中执行 SQL）
   - **理由**：MVP 聚焦于生成 SQL，用户自行到数据库工具中执行

2. **DDL 高级功能**
   - ❌ DDL 关系图可视化
   - ❌ 表之间依赖关系分析
   - ❌ 数据字典自动生成
   - **理由**：非核心功能，可在 MVP 验证后增强

3. **用户管理与权限**
   - ❌ 多用户登录和身份认证
   - ❌ 权限管理（限制访问特定数据库/表）
   - ❌ 操作审计日志
   - **理由**：MVP 阶段为单用户使用，验证核心价值后再扩展

4. **数据库直连**
   - ❌ 直接连接数据库获取 DDL
   - ❌ 支持多种数据库类型（MySQL, PostgreSQL, Oracle 等）
   - **理由**：MVP 阶段通过文件上传获取 DDL，降低复杂度

5. **高级 Agent 能力**
   - ❌ 多轮复杂推理（如分步骤执行多个查询）
   - ❌ 自动优化查询性能
   - ❌ 自动修复 SQL 错误
   - **理由**：MVP 聚焦于基础 SQL 生成，验证 RAG 有效性

### MVP Success Criteria

**MVP 验收标准：**

1. **功能完整性**
   - ✅ 用户可以上传 DDL 文件并成功解析（成功率 ≥ 90%）
   - ✅ 文件管理界面可以查看、删除文件
   - ✅ 系统能够识别 SQL 生成意图并触发 RAG
   - ✅ Agent 能够自主调用向量检索工具
   - ✅ SQL 生成准确率 ≥ 80%
   - ✅ 展示引用的表和字段（可解释性）

2. **性能指标**
   - ✅ DDL 向量化速度 < 5 秒/文件
   - ✅ SQL 生成响应时间 < 3 秒
   - ✅ 对话响应时间 < 2 秒
   - ✅ 向量检索相关性 ≥ 85%

3. **用户体验**
   - ✅ 用户首次使用能够在 5 分钟内成功生成第一条 SQL
   - ✅ 界面友好，操作流程清晰（无需手册即可上手）
   - ✅ 错误提示明确，帮助用户排查问题

4. **技术质量**
   - ✅ 代码符合 DDD 分层架构
   - ✅ 遵循 SOLID 原则，设计模式应用合理
   - ✅ 系统可用性 ≥ 99.5%
   - ✅ 错误率 < 2%

5. **业务验证**
   - ✅ 10-20 个产品经理试用系统
   - ✅ 用户自助完成率 ≥ 80%
   - ✅ 用户满意度评分 ≥ 4.0/5.0
   - ✅ 开发团队 SQL 请求减少 ≥ 30%

### Future Vision

**后 MVP 演进路径：**

**Phase 2: 功能增强（3-6 个月）**
1. **SQL 增强功能**
   - SQL 语法验证和错误提示
   - SQL 执行和结果预览
   - SQL 执行历史记录

2. **DDL 可视化**
   - DDL 关系图可视化
   - 表之间依赖关系分析
   - 数据字典自动生成

3. **多数据库支持**
   - 支持 MySQL, PostgreSQL, Oracle, SQL Server
   - 数据库方言自动适配

**Phase 3: 企业级扩展（6-12 个月）**
1. **用户与权限管理**
   - 多用户登录和身份认证
   - 基于角色的权限控制（RBAC）
   - 操作审计日志

2. **数据库直连**
   - 直接连接数据库获取 DDL
   - 自动同步表结构变更
   - 支持多数据源管理

3. **高级 Agent 能力**
   - 多轮复杂推理和任务拆解
   - 自动优化查询性能
   - 自动修复常见 SQL 错误

**Phase 4: 平台化（12+ 个月）**
1. **数据分析平台**
   - 集成数据可视化功能
   - 支持数据报表自动生成
   - 数据洞察自动发现

2. **生态扩展**
   - 开放 API 供第三方集成
   - 插件机制支持自定义扩展
   - 社区共享 SQL 模板库
