# Test Design: Epic 4 - å¤šç»´åº¦è´¨é‡ä¿éšœ ğŸ›¡ï¸

**Date:** 2026-01-25
**Author:** Jxin
**Status:** Draft

---

## Executive Summary

**Scope:** å®Œæ•´æµ‹è¯•è®¾è®¡ - Epic 4ï¼ˆå¤šç»´åº¦è´¨é‡ä¿éšœï¼‰

**Risk Summary:**

- Total risks identified: 10
- High-priority risks (â‰¥6): 3
- Critical categories: TECH, BUS, DATA

**Coverage Summary:**

- P0 scenarios: 10 (20 hours)
- P1 scenarios: 8 (8 hours)
- P2/P3 scenarios: 6 (2.5 hours)
- **Total effort**: 30.5 hours (~4 days)

---

## Risk Assessment

### High-Priority Risks (Score â‰¥6)

| Risk ID | Category | Description | Probability | Impact | Score | Mitigation | Owner | Timeline |
| ------- | -------- | ----------- | ----------- | ------ | ----- | ---------- | ----- | -------- |
| R-401 | TECH | å¤šå±‚éªŒè¯é€»è¾‘ç¼ºé™·å¯¼è‡´é”™è¯¯ SQL é€šè¿‡éªŒè¯ | 2 | 3 | 6 | éªŒè¯æœºåˆ¶æµ‹è¯•ï¼ˆè¯­æ³•ã€å¼•ç”¨ã€é€»è¾‘ä¸‰å±‚ï¼‰ | Dev | Sprint 2 |
| R-402 | DATA | è¾“å‡ºä¸€è‡´æ€§ < 95% å¯¼è‡´ç”¨æˆ·å›°æƒ‘ | 2 | 3 | 6 | ä¸€è‡´æ€§æµ‹è¯•ï¼ˆç›¸åŒè¾“å…¥ 5 æ¬¡éªŒè¯ï¼‰ | Dev | Sprint 2-3 |
| R-403 | BUS | é”™è¯¯æç¤ºä¸å‹å¥½å¯¼è‡´ç”¨æˆ·æŒ«è´¥æ„Ÿ | 2 | 3 | 6 | å‹å¥½é”™è¯¯æç¤ºæµ‹è¯• + ç”¨æˆ·ä½“éªŒè¯„å®¡ | QA | Sprint 2-3 |

### Medium-Priority Risks (Score 3-4)

| Risk ID | Category | Description | Probability | Impact | Score | Mitigation | Owner |
| ------- | -------- | ----------- | ----------- | ------ | ----- | ---------- | ----- |
| R-404 | TECH | SQL é‡è¯•æœºåˆ¶å¤±æ•ˆ | 1 | 3 | 3 | é‡è¯•é€»è¾‘æµ‹è¯• | Dev |
| R-405 | TECH | å•å…ƒæµ‹è¯•è¦†ç›–ç‡ä¸è¶³ï¼ˆ< 80%ï¼‰ | 2 | 2 | 4 | æµ‹è¯•è¦†ç›–ç‡ç›‘æ§ | Dev |
| R-406 | TECH | é›†æˆæµ‹è¯•æœªè¦†ç›–å…³é”®è·¯å¾„ | 1 | 3 | 3 | E2E æµ‹è¯•è¡¥å…… | QA |
| R-407 | DATA | éªŒè¯é”™è¯¯åˆ†ç±»ä¸å‡†ç¡® | 1 | 2 | 2 | é”™è¯¯åˆ†ç±»æµ‹è¯• | Dev |

### Low-Priority Risks (Score 1-2)

| Risk ID | Category | Description | Probability | Impact | Score | Action |
| ------- | -------- | ----------- | ----------- | ------ | ----- | ------ |
| R-408 | TECH | æµ‹è¯•æ‰§è¡Œæ—¶é—´è¿‡é•¿ | 1 | 2 | 2 | Monitor |
| R-409 | TECH | æµ‹è¯•æ•°æ®ç»´æŠ¤å›°éš¾ | 1 | 1 | 1 | Monitor |
| R-410 | TECH | æµ‹è¯•æŠ¥å‘Šæ ¼å¼ä¸æ¸…æ™° | 1 | 1 | 1 | Monitor |

---

## Test Coverage Plan

### P0 (Critical) - Run on every commit

**Criteria**: è´¨é‡ä¿éšœæœºåˆ¶ + é«˜é£é™© (â‰¥6) + æ— æ›¿ä»£æ–¹æ¡ˆ

| Requirement | Test Level | Risk Link | Test Count | Owner | Notes |
| ----------- | ---------- | --------- | ---------- | ----- | ----- |
| **è¯­æ³•éªŒè¯æ­£ç¡®æ€§** | Integration | R-401 | 2 | Dev | æ­£ç¡® SQL é€šè¿‡ + é”™è¯¯ SQL æ‹¦æˆª |
| **å¼•ç”¨éªŒè¯æ­£ç¡®æ€§** | Integration | R-401 | 2 | Dev | è¡¨/å­—æ®µå­˜åœ¨ + ä¸å­˜åœ¨ |
| **é€»è¾‘éªŒè¯æ­£ç¡®æ€§** | Integration | R-401 | 2 | Dev | JOIN åˆç†æ€§ + GROUP BY ä¸€è‡´æ€§ |
| **éªŒè¯å¤±è´¥åˆ†çº§å¤„ç†** | Integration | R-407 | 1 | Dev | Critical/Warning/Info åˆ†ç±» |
| **è¾“å‡ºä¸€è‡´æ€§ï¼ˆå•è¡¨æŸ¥è¯¢ï¼‰** | Integration | R-402 | 2 | Dev | ç›¸åŒè¾“å…¥ 5 æ¬¡éªŒè¯ |
| **è¾“å‡ºä¸€è‡´æ€§ï¼ˆå¤æ‚æŸ¥è¯¢ï¼‰** | Integration | R-402 | 1 | Dev | JOIN æŸ¥è¯¢ä¸€è‡´æ€§ |
| **å‹å¥½é”™è¯¯æç¤ºï¼ˆè§£æå¤±è´¥ï¼‰** | E2E | R-403 | 1 | QA | é”™è¯¯åŸå›  + ä¿®æ­£å»ºè®® |
| **å‹å¥½é”™è¯¯æç¤ºï¼ˆç”Ÿæˆå¤±è´¥ï¼‰** | E2E | R-403 | 1 | QA | å‹å¥½æç¤º + é‡è¯•å»ºè®® |
| **å‹å¥½é”™è¯¯æç¤ºï¼ˆå‘é‡æ£€ç´¢å¤±è´¥ï¼‰** | E2E | R-403 | 1 | QA | æ˜ç¡®å‘ŠçŸ¥ï¼Œä¸ç”Ÿæˆé”™è¯¯ SQL |
| **å‹å¥½é”™è¯¯æç¤ºï¼ˆAPI é”™è¯¯ï¼‰** | E2E | R-403 | 1 | QA | åˆ†ç±»é”™è¯¯ï¼ˆ429ã€500ã€ç½‘ç»œï¼‰ |

**Total P0**: 14 tests, 28 hours

### P1 (High) - Run on PR to main

**Criteria**: é‡è¦è´¨é‡æœºåˆ¶ + ä¸­é£é™© (3-4) + å½±å“å¯é æ€§

| Requirement | Test Level | Risk Link | Test Count | Owner | Notes |
| ----------- | ---------- | --------- | ---------- | ----- | ----- |
| SQL é‡è¯•æœºåˆ¶ï¼ˆç¬¬ 1 æ¬¡é‡è¯•ï¼‰ | Integration | R-404 | 1 | Dev | è°ƒæ•´ Prompt é‡è¯• |
| SQL é‡è¯•æœºåˆ¶ï¼ˆç¬¬ 2 æ¬¡é‡è¯•ï¼‰ | Integration | R-404 | 1 | Dev | ç®€åŒ–è§„åˆ™é‡è¯• |
| é‡è¯•å¤±è´¥è¿”å›é”™è¯¯ | Integration | R-404 | 1 | Dev | 2 æ¬¡ä»å¤±è´¥ |
| å•å…ƒæµ‹è¯•è¦†ç›–ç‡éªŒè¯ | Unit | R-405 | 1 | Dev | pytest-cov â‰¥ 80% |
| æ ¸å¿ƒæ¨¡å—å•å…ƒæµ‹è¯• | Unit | R-405 | 3 | Dev | è§£æã€å‘é‡åŒ–ã€éªŒè¯æ¨¡å— |
| é›†æˆæµ‹è¯•ç«¯åˆ°ç«¯æµç¨‹ | Integration | R-406 | 1 | QA | DDL ä¸Šä¼ â†’ç”Ÿæˆ SQL |

**Total P1**: 8 tests, 8 hours

### P2 (Medium) - Run nightly/weekly

**Criteria**: æ¬¡è¦è´¨é‡åœºæ™¯ + ä½é£é™© (1-2)

| Requirement | Test Level | Risk Link | Test Count | Owner | Notes |
| ----------- | ---------- | --------- | ---------- | ----- | ----- |
| æµ‹è¯•æ‰§è¡Œæ€§èƒ½ | Performance | R-408 | 1 | QA | å…¨å¥—æµ‹è¯• < 10 åˆ†é’Ÿ |
| æµ‹è¯•æ•°æ®å·¥å‚ | Unit | R-409 | 2 | Dev | åˆ›å»ºæµ‹è¯• DDLã€æŸ¥è¯¢ |
| æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ | Integration | R-410 | 1 | QA | pytest-html æŠ¥å‘Š |
| é”™è¯¯æ—¥å¿—å®Œæ•´æ€§ | Integration | - | 1 | Dev | éªŒè¯æ—¥å¿—åŒ…å«å †æ ˆ |
| éªŒè¯è€—æ—¶ç›‘æ§ | Performance | - | 1 | Dev | ä¸‰å±‚éªŒè¯ < 500ms |

**Total P2**: 6 tests, 3 hours

### P3 (Low) - Run on-demand

**Criteria**: æ¢ç´¢æ€§æµ‹è¯•

- æ— ï¼ˆEpic 4 ä¸ºè´¨é‡ä¿éšœï¼Œæ‰€æœ‰æµ‹è¯•éƒ½æ˜¯ P0-P2ï¼‰

**Total P3**: 0 tests, 0 hours

---

## Execution Order

### Smoke Tests (<5 min)

**Purpose**: å¿«é€Ÿåé¦ˆï¼Œè´¨é‡é—¨ç¦åŸºæœ¬æ£€æŸ¥

- [ ] ç”Ÿæˆæ ‡å‡† SQL é€šè¿‡è¯­æ³•éªŒè¯ï¼ˆ1minï¼‰
- [ ] é”™è¯¯ SQL è¢«éªŒè¯æœºåˆ¶æ‹¦æˆªï¼ˆ1minï¼‰
- [ ] ç›¸åŒè¾“å…¥ç”Ÿæˆç›¸åŒ SQLï¼ˆ2minï¼‰

**Total**: 3 scenarios

### P0 Tests (<20 min)

**Purpose**: éªŒè¯æ ¸å¿ƒè´¨é‡ä¿éšœæœºåˆ¶

- [ ] è¯­æ³•éªŒè¯ï¼ˆæ­£ç¡® + é”™è¯¯ï¼‰ï¼ˆIntegration, 2Ã—2minï¼‰
- [ ] å¼•ç”¨éªŒè¯ï¼ˆå­˜åœ¨ + ä¸å­˜åœ¨ï¼‰ï¼ˆIntegration, 2Ã—2minï¼‰
- [ ] é€»è¾‘éªŒè¯ï¼ˆåˆç† + ä¸åˆç†ï¼‰ï¼ˆIntegration, 2Ã—2minï¼‰
- [ ] éªŒè¯å¤±è´¥åˆ†çº§ï¼ˆIntegration, 1Ã—2minï¼‰
- [ ] è¾“å‡ºä¸€è‡´æ€§ï¼ˆå•è¡¨ï¼‰ï¼ˆIntegration, 2Ã—2minï¼‰
- [ ] è¾“å‡ºä¸€è‡´æ€§ï¼ˆå¤æ‚ï¼‰ï¼ˆIntegration, 1Ã—2minï¼‰
- [ ] å‹å¥½é”™è¯¯æç¤ºï¼ˆ4 ç§åœºæ™¯ï¼‰ï¼ˆE2E, 4Ã—2minï¼‰

**Total**: 14 scenarios

### P1 Tests (<20 min)

**Purpose**: é‡è¦è´¨é‡æœºåˆ¶å’Œè¦†ç›–ç‡

- [ ] SQL é‡è¯•æœºåˆ¶ï¼ˆ3 ä¸ªåœºæ™¯ï¼‰ï¼ˆIntegration, 3Ã—1minï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼ˆUnit, 1Ã—1minï¼‰
- [ ] æ ¸å¿ƒæ¨¡å—å•å…ƒæµ‹è¯•ï¼ˆUnit, 3Ã—1minï¼‰
- [ ] ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•ï¼ˆIntegration, 1Ã—2minï¼‰

**Total**: 8 scenarios

### P2/P3 Tests (<10 min)

**Purpose**: æµ‹è¯•åŸºç¡€è®¾æ–½å’Œç›‘æ§

- [ ] æµ‹è¯•æ‰§è¡Œæ€§èƒ½ï¼ˆPerformance, 1Ã—1minï¼‰
- [ ] æµ‹è¯•æ•°æ®å·¥å‚ï¼ˆUnit, 2Ã—1minï¼‰
- [ ] æµ‹è¯•æŠ¥å‘Šç”Ÿæˆï¼ˆIntegration, 1Ã—1minï¼‰
- [ ] é”™è¯¯æ—¥å¿—å®Œæ•´æ€§ï¼ˆIntegration, 1Ã—1minï¼‰
- [ ] éªŒè¯è€—æ—¶ç›‘æ§ï¼ˆPerformance, 1Ã—1minï¼‰

**Total**: 6 scenarios

---

## Resource Estimates

### Test Development Effort

| Priority | Count | Hours/Test | Total Hours | Notes |
| -------- | ----- | ---------- | ----------- | ----- |
| P0 | 14 | 2.0 | 28 | å¤æ‚éªŒè¯é€»è¾‘ã€ä¸€è‡´æ€§æµ‹è¯• |
| P1 | 8 | 1.0 | 8 | æ ‡å‡†è´¨é‡éªŒè¯ |
| P2 | 6 | 0.5 | 3 | æµ‹è¯•åŸºç¡€è®¾æ–½ |
| P3 | 0 | 0.25 | 0 | æ—  |
| **Total** | **28** | **-** | **39** | **~5 days** |

### Prerequisites

**Test Data:**

- **é”™è¯¯ SQL æµ‹è¯•é›†**ï¼š
  - `test-sql-syntax-errors.json`ï¼šè¯­æ³•é”™è¯¯ SQLï¼ˆ10 ä¸ªï¼‰
  - `test-sql-reference-errors.json`ï¼šå¼•ç”¨ä¸å­˜åœ¨çš„è¡¨/å­—æ®µï¼ˆ10 ä¸ªï¼‰
  - `test-sql-logic-errors.json`ï¼šé€»è¾‘ä¸åˆç† SQLï¼ˆ5 ä¸ªï¼‰
  
- **ä¸€è‡´æ€§æµ‹è¯•é›†**ï¼š
  - `test-consistency-simple.json`ï¼š20 ä¸ªç®€å•æŸ¥è¯¢
  - `test-consistency-complex.json`ï¼š10 ä¸ªå¤æ‚æŸ¥è¯¢
  - æ¯ä¸ªæŸ¥è¯¢æ‰§è¡Œ 5 æ¬¡ï¼ŒéªŒè¯ä¸€è‡´æ€§

**Tooling:**

- Pytestï¼ˆUnit + Integration æµ‹è¯•ï¼‰
- pytest-covï¼ˆè¦†ç›–ç‡ç»Ÿè®¡ï¼‰
- sqlparse/sqlglotï¼ˆSQL éªŒè¯ï¼‰
- Playwrightï¼ˆE2E é”™è¯¯æç¤ºæµ‹è¯•ï¼‰

**Environment:**

- Python 3.9+ æµ‹è¯•ç¯å¢ƒ
- æµ‹è¯• DDL å‘é‡åº“å·²åˆå§‹åŒ–
- LLM API é…ç½®å°±ç»ª

---

## Quality Gate Criteria

### Pass/Fail Thresholds

- **P0 pass rate**: 100% (no exceptions)
- **P1 pass rate**: â‰¥95%
- **P2/P3 pass rate**: â‰¥90%
- **High-risk mitigations**: 100% complete (R-401 to R-403)

### Coverage Targets

- **éªŒè¯æœºåˆ¶è¦†ç›–**: 100%ï¼ˆä¸‰å±‚éªŒè¯ï¼‰
- **ä¸€è‡´æ€§æµ‹è¯•**: 95% ä¸€è‡´æ€§ï¼ˆç›¸åŒè¾“å…¥ç”Ÿæˆç›¸åŒ SQLï¼‰
- **é”™è¯¯æç¤ºå‹å¥½åº¦**: 100%ï¼ˆæ‰€æœ‰é”™è¯¯åœºæ™¯æœ‰å‹å¥½æç¤ºï¼‰
- **å•å…ƒæµ‹è¯•è¦†ç›–ç‡**: â‰¥80%

### Non-Negotiable Requirements

- [ ] ä¸‰å±‚éªŒè¯æœºåˆ¶å…¨éƒ¨å·¥ä½œæ­£å¸¸
- [ ] è¾“å‡ºä¸€è‡´æ€§ â‰¥ 95%
- [ ] æ‰€æœ‰é”™è¯¯åœºæ™¯æœ‰å‹å¥½æç¤º
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

---

## Mitigation Plans

### R-401: éªŒè¯é€»è¾‘ç¼ºé™· (Score: 6)

**Mitigation Strategy:**
1. **ä¸‰å±‚éªŒè¯å…¨è¦†ç›–æµ‹è¯•**ï¼š
   - **ç¬¬ 1 å±‚ï¼ˆè¯­æ³•éªŒè¯ï¼‰**ï¼š
     - æµ‹è¯•æ­£ç¡® SQL é€šè¿‡ï¼ˆ10 ä¸ªæ¡ˆä¾‹ï¼‰
     - æµ‹è¯•é”™è¯¯ SQL æ‹¦æˆªï¼ˆ10 ä¸ªæ¡ˆä¾‹ï¼šç¼ºå°‘åˆ†å·ã€æ‹¬å·ä¸åŒ¹é…ã€å…³é”®å­—æ‹¼å†™é”™è¯¯ï¼‰
   - **ç¬¬ 2 å±‚ï¼ˆå¼•ç”¨éªŒè¯ï¼‰**ï¼š
     - æµ‹è¯•è¡¨å­˜åœ¨éªŒè¯ï¼ˆ5 ä¸ªæ¡ˆä¾‹ï¼‰
     - æµ‹è¯•è¡¨ä¸å­˜åœ¨æ‹¦æˆªï¼ˆ5 ä¸ªæ¡ˆä¾‹ï¼‰
     - æµ‹è¯•å­—æ®µå­˜åœ¨éªŒè¯ï¼ˆ5 ä¸ªæ¡ˆä¾‹ï¼‰
     - æµ‹è¯•å­—æ®µä¸å­˜åœ¨æ‹¦æˆªï¼ˆ5 ä¸ªæ¡ˆä¾‹ï¼‰
   - **ç¬¬ 3 å±‚ï¼ˆé€»è¾‘éªŒè¯ï¼‰**ï¼š
     - æµ‹è¯• JOIN æ¡ä»¶åˆç†æ€§ï¼ˆ3 ä¸ªæ¡ˆä¾‹ï¼‰
     - æµ‹è¯• GROUP BY ä¸€è‡´æ€§ï¼ˆ3 ä¸ªæ¡ˆä¾‹ï¼‰
     - æµ‹è¯• ORDER BY å­—æ®µå­˜åœ¨æ€§ï¼ˆ2 ä¸ªæ¡ˆä¾‹ï¼‰
     
2. **é”™è¯¯åˆ†çº§æµ‹è¯•**ï¼š
   - Critical é”™è¯¯ï¼šè¯­æ³•é”™è¯¯ã€è¡¨/å­—æ®µä¸å­˜åœ¨ â†’ æ‹’ç» SQL
   - Warning é”™è¯¯ï¼šé€»è¾‘ä¸åˆç† â†’ è¿”å› SQL + è­¦å‘Š
   - Info ä¿¡æ¯ï¼šæ€§èƒ½å»ºè®® â†’ è¿”å› SQL + å»ºè®®
   
3. **ä»£ç å®¡æŸ¥æ£€æŸ¥ç‚¹**ï¼š
   - éªŒè¯ä»£ç å¿…é¡»æœ‰å•å…ƒæµ‹è¯•
   - éªŒè¯é€»è¾‘ä¸èƒ½ç»•è¿‡ï¼ˆæ—  try-catch åå¼‚å¸¸ï¼‰

**Owner:** Dev
**Timeline:** Sprint 2
**Status:** Planned
**Verification:** Integration æµ‹è¯•éªŒè¯ä¸‰å±‚éªŒè¯ 100% å·¥ä½œ

---

### R-402: è¾“å‡ºä¸€è‡´æ€§ä¸è¶³ (Score: 6)

**Mitigation Strategy:**
1. **LLM é…ç½®ä¼˜åŒ–**ï¼š
   - Temperature = 0ï¼ˆå®Œå…¨ç¡®å®šæ€§è¾“å‡ºï¼‰
   - Top-p = 1.0
   - ç¦ç”¨ Random Seedï¼ˆæˆ–å›ºå®š seed ç”¨äºæµ‹è¯•ï¼‰
   
2. **ä¸€è‡´æ€§æµ‹è¯•**ï¼š
   - æ„å»ºæµ‹è¯•é›†ï¼ˆ30 ä¸ªæŸ¥è¯¢ï¼‰
   - æ¯ä¸ªæŸ¥è¯¢æ‰§è¡Œ 5 æ¬¡ç”Ÿæˆ
   - è®¡ç®—ä¸€è‡´æ€§æ¯”ä¾‹ï¼šç›¸åŒè¾“å‡ºæ¬¡æ•° / æ€»æ¬¡æ•°
   - ç›®æ ‡ï¼šâ‰¥ 95% å®Œå…¨ä¸€è‡´
   
3. **å‘é‡æ£€ç´¢ç¨³å®šæ€§**ï¼š
   - ç›¸åŒæŸ¥è¯¢æ–‡æœ¬è¿”å›ç›¸åŒ Top-K ç»“æœ
   - å‘é‡åº“ä¸å˜æ—¶ï¼Œæ£€ç´¢ç»“æœé¡ºåºç¨³å®š
   
4. **Agent æ‰§è¡Œç¡®å®šæ€§**ï¼š
   - ç›¸åŒè¾“å…¥æ‰§è¡Œç›¸åŒå·¥å…·è°ƒç”¨é¡ºåº
   - ç›¸åŒ Prompt æ„å»ºé€»è¾‘
   
5. **å…è®¸çš„ä¸ä¸€è‡´**ï¼ˆç­‰ä»·è¾“å‡ºï¼‰ï¼š
   - å­—æ®µé¡ºåºä¸åŒä½†è¯­ä¹‰ç›¸åŒï¼ˆ`SELECT a, b` vs `SELECT b, a`ï¼‰
   - è¯­æ³•ç­‰ä»·å†™æ³•ï¼ˆ`!=` vs `<>`ï¼‰
   - è¿™äº›æƒ…å†µæ ‡è®°ä¸º"ç­‰ä»·è¾“å‡º"ï¼Œä¸è§†ä¸ºé”™è¯¯

**Owner:** Dev
**Timeline:** Sprint 2-3
**Status:** Planned
**Verification:** 
- ä¸€è‡´æ€§æµ‹è¯• â‰¥ 95%
- ä¸ä¸€è‡´æ¡ˆä¾‹æœ‰è¯¦ç»†æ—¥å¿—ï¼ˆè¾“å…¥ã€ä¸¤æ¬¡ SQLã€å·®å¼‚ã€åŸå› ï¼‰

---

### R-403: é”™è¯¯æç¤ºä¸å‹å¥½ (Score: 6)

**Mitigation Strategy:**
1. **é”™è¯¯åˆ†ç±»**ï¼š
   - **ç”¨æˆ·è¾“å…¥é”™è¯¯**ï¼šéœ€æ±‚æè¿°ä¸æ¸…ã€DDL æ ¼å¼é”™è¯¯
   - **ç³»ç»Ÿå†…éƒ¨é”™è¯¯**ï¼šSQL ç”Ÿæˆå¤±è´¥ã€å‘é‡æ£€ç´¢å¤±è´¥ã€API è°ƒç”¨å¤±è´¥
   - **èµ„æºä¸å¯ç”¨**ï¼šDDL æœªè§£æã€å‘é‡åº“æœªåˆå§‹åŒ–ã€ç½‘ç»œé”™è¯¯
   - **æ€§èƒ½è¶…æ—¶**ï¼šç”Ÿæˆè¶…æ—¶ã€è§£æè¶…æ—¶
   
2. **å‹å¥½æç¤ºæ¨¡æ¿**ï¼š
   - **ç”¨æˆ·è¾“å…¥é”™è¯¯**ï¼š
     - âŒ "Error: Invalid input"
     - âœ… "æŠ±æ­‰ï¼Œæˆ‘æ— æ³•ç†è§£æ‚¨çš„éœ€æ±‚ã€‚è¯·å°è¯•æ›´å…·ä½“åœ°æè¿°ï¼Œä¾‹å¦‚ï¼š'æŸ¥è¯¢ç”¨æˆ·è¡¨ä¸­æ³¨å†Œæ—¶é—´åœ¨æœ€è¿‘ 7 å¤©çš„ç”¨æˆ·'"
   - **DDL è§£æå¤±è´¥**ï¼š
     - âŒ "Parsing error at line 45"
     - âœ… "DDL æ–‡ä»¶è§£æå¤±è´¥ï¼šç¬¬ 45 è¡Œå­˜åœ¨è¯­æ³•é”™è¯¯ã€‚è¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œæˆ–å°è¯•ä½¿ç”¨æ ‡å‡†çš„ CREATE TABLE è¯­å¥ã€‚"
   - **SQL ç”Ÿæˆå¤±è´¥**ï¼š
     - âŒ "Generation failed"
     - âœ… "æš‚æ—¶æ— æ³•ç”Ÿæˆ SQLï¼Œå¯èƒ½çš„åŸå› ï¼šå½“å‰éœ€æ±‚è¾ƒå¤æ‚ï¼Œæˆ– DDL æ–‡ä»¶ä¿¡æ¯ä¸è¶³ã€‚å»ºè®®ï¼š1) ç®€åŒ–éœ€æ±‚æè¿°ï¼›2) æ£€æŸ¥ DDL æ–‡ä»¶æ˜¯å¦åŒ…å«æ‰€éœ€è¡¨å’Œå­—æ®µã€‚"
   - **API è°ƒç”¨å¤±è´¥**ï¼š
     - âŒ "API error 429"
     - âœ… "è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•ï¼ˆ1 åˆ†é’Ÿåé‡è¯•ï¼‰"
   
3. **E2E æµ‹è¯•éªŒè¯**ï¼š
   - è§¦å‘æ¯ç§é”™è¯¯åœºæ™¯
   - éªŒè¯é”™è¯¯æç¤ºæ–‡æ¡ˆå‹å¥½
   - éªŒè¯æç¤ºåŒ…å«å…·ä½“åŸå› å’Œå»ºè®®
   
4. **ç”¨æˆ·ä½“éªŒè¯„å®¡**ï¼š
   - é‚€è¯·äº§å“ç»ç†æµ‹è¯•é”™è¯¯åœºæ™¯
   - æ”¶é›†åé¦ˆä¼˜åŒ–æç¤ºæ–‡æ¡ˆ

**Owner:** QA + UX
**Timeline:** Sprint 2-3
**Status:** Planned
**Verification:** E2E æµ‹è¯• + ç”¨æˆ·ä½“éªŒè¯„å®¡é€šè¿‡

---

## Assumptions and Dependencies

### Assumptions

1. LLM Temperature = 0 å¯ä»¥è¾¾åˆ° â‰¥ 95% çš„è¾“å‡ºä¸€è‡´æ€§
2. SQL Parser åº“å¯ä»¥å‡†ç¡®éªŒè¯è¯­æ³•
3. é”™è¯¯æç¤ºæ–‡æ¡ˆç»è¿‡ UX å®¡æŸ¥

### Dependencies

1. Epic 1 å®Œæˆï¼ˆé¡¹ç›®åŸºç¡€ï¼‰- Sprint 2 å¼€å§‹å‰
2. Epic 2 å®Œæˆï¼ˆDDL å‘é‡åº“å°±ç»ªï¼‰- Sprint 2 å¼€å§‹å‰
3. Epic 3 å®Œæˆï¼ˆSQL ç”ŸæˆåŠŸèƒ½ï¼‰- Sprint 2 å¼€å§‹å‰
4. æµ‹è¯•æ•°æ®å‡†å¤‡ï¼ˆé”™è¯¯ SQL é›†ã€ä¸€è‡´æ€§æµ‹è¯•é›†ï¼‰- Sprint 2 å¼€å§‹å‰

### Risks to Plan

- **Risk**: Temperature = 0 ä»æ— æ³•è¾¾åˆ° 95% ä¸€è‡´æ€§
  - **Impact**: ç”¨æˆ·å›°æƒ‘ï¼ˆç›¸åŒè¾“å…¥ä¸åŒè¾“å‡ºï¼‰
  - **Contingency**: æ¥å— 90% ä¸€è‡´æ€§ + æ–‡æ¡£è¯´æ˜"AI ç”Ÿæˆå¯èƒ½æœ‰ç»†å¾®å·®å¼‚"

---

## Follow-on Workflows

- Run `*atdd` to generate failing P0 tests (éªŒè¯æœºåˆ¶ã€ä¸€è‡´æ€§ã€é”™è¯¯æç¤º).
- Run `*automate` for broader coverage.

---

## Approval

**Test Design Approved By:**

- [ ] Product Manager: ___ Date: ___
- [ ] Tech Lead: ___ Date: ___
- [ ] QA Lead: ___ Date: ___

**Comments:**

---

## Appendix

### Knowledge Base References

- `risk-governance.md` - Risk classification framework
- `probability-impact.md` - Risk scoring methodology
- `test-levels-framework.md` - Test level selection
- `test-priorities-matrix.md` - P0-P3 prioritization

### Related Documents

- PRD: `_bmad-output/planning-artifacts/prd.md`
- Epic: `_bmad-output/planning-artifacts/epics.md#epic-4`
- Architecture: `_bmad-output/planning-artifacts/architecture.md`

---

**Generated by**: BMad TEA Agent - Test Architect Module
**Workflow**: `_bmad/bmm/testarch/test-design`
**Version**: 4.0 (BMad v6)
