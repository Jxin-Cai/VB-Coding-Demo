import{_ as j,u as E,r as _,m as O,c as y,o as h,b as r,n as I,a as t,j as w,w as a,f as x,p as z,d as m,q as A,s as J,i as G,F as H,v as K,E as U,l as Q,t as b,g as W,x as X}from"./index-Gyt2orIW.js";import{a as F}from"./index-Bh12ySJS.js";const Y={class:"pool-list-container"},Z={class:"page-header"},ee={class:"header-content"},oe={class:"pools-grid"},te=["onClick"],se={class:"pool-card-header"},le={class:"pool-description"},ae={class:"pool-card-footer"},re={class:"creator-info"},ne={class:"create-time"},ie={key:0,class:"empty-state"},ue={__name:"PoolList",setup(ce){const L=Q(),p=E(),C=_(!1),g=_([]),v=_(!1),P=_(!1),M=_(null),i=_({name:"",description:""}),N={name:[{required:!0,message:"请输入需求池名称",trigger:"blur"},{min:1,max:100,message:"名称长度在1-100字符之间",trigger:"blur"}],description:[{max:500,message:"描述长度不能超过500字符",trigger:"blur"}]},D=async()=>{C.value=!0;try{const o=await F.getPools();o.code===200?g.value=o.data:(console.error("加载需求池列表失败:",o.message),g.value=[])}catch(o){console.error("加载需求池列表失败:",o),g.value=[]}finally{C.value=!1}},S=()=>{i.value={name:"",description:""},v.value=!0},B=async()=>{M.value&&await M.value.validate(async o=>{var e,u,c,f;if(o){P.value=!0;try{console.log("创建需求池 - 当前用户:",p.currentUser),console.log("创建需求池 - 用户名:",(e=p.currentUser)==null?void 0:e.name);let s=((u=p.currentUser)==null?void 0:u.name)||"";if(!s){const V=localStorage.getItem("user");if(V)try{s=JSON.parse(V).name||""}catch(k){console.error("解析用户信息失败:",k)}}s||(s="匿名用户"),console.log("创建需求池 - 最终使用的用户名:",s);const n={...i.value,createdBy:s};console.log("创建需求池 - 请求数据:",n);const d=await F.createPool(n);d.code===200?(U.success("需求池创建成功"),v.value=!1,i.value={name:"",description:""},await D()):U.error(d.message||"创建失败")}catch(s){console.error("创建需求池失败:",s);const n=((f=(c=s.response)==null?void 0:c.data)==null?void 0:f.message)||s.message||"创建需求池失败，请检查网络连接";U.error(n)}finally{P.value=!1}}})},R=o=>{L.push({path:"/backlog",query:{poolId:o}})},$=o=>!o||o===0?"info":o<5?"warning":"success",q=o=>{if(!o)return"";const e=new Date(o),c=new Date-e,f=Math.floor(c/1e3),s=Math.floor(f/60),n=Math.floor(s/60),d=Math.floor(n/24);return d>0?`${d}天前`:n>0?`${n}小时前`:s>0?`${s}分钟前`:"刚刚"};return O(()=>{var o;console.log("PoolList onMounted - userStore:",p),console.log("PoolList onMounted - currentUser:",p.currentUser),console.log("PoolList onMounted - 当前用户名:",(o=p.currentUser)==null?void 0:o.name),D()}),(o,e)=>{const u=m("el-icon"),c=m("el-button"),f=m("el-tag"),s=m("el-empty"),n=m("el-input"),d=m("el-form-item"),V=m("el-form"),k=m("el-dialog"),T=J("loading");return h(),y("div",Y,[r("div",Z,[r("div",ee,[r("h1",null,[t(u,null,{default:a(()=>[t(x(z))]),_:1}),e[4]||(e[4]=w(" 需求池管理 ",-1))]),e[5]||(e[5]=r("p",{class:"subtitle"},"选择一个需求池查看故事卡",-1))]),t(c,{type:"primary",size:"large",onClick:S},{default:a(()=>[t(u,null,{default:a(()=>[t(x(A))]),_:1}),e[6]||(e[6]=w(" 创建需求池 ",-1))]),_:1})]),I((h(),y("div",oe,[(h(!0),y(H,null,K(g.value,l=>(h(),y("div",{key:l.id,class:"pool-card",onClick:de=>R(l.id)},[r("div",se,[r("h3",null,b(l.name),1),t(f,{type:$(l.storyCardCount)},{default:a(()=>[w(b(l.storyCardCount||0)+" 张卡 ",1)]),_:2},1032,["type"])]),r("p",le,b(l.description||"暂无描述"),1),r("div",ae,[r("div",re,[t(u,null,{default:a(()=>[t(x(W))]),_:1}),r("span",null,b(l.createdBy),1)]),r("div",ne,[t(u,null,{default:a(()=>[t(x(X))]),_:1}),r("span",null,b(q(l.createdAt)),1)])])],8,te))),128)),g.value.length===0&&!C.value?(h(),y("div",ie,[t(s,{description:"还没有需求池，创建第一个吧！"})])):G("",!0)])),[[T,C.value]]),t(k,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=l=>v.value=l),title:"创建需求池",width:"500px","close-on-click-modal":!1},{footer:a(()=>[t(c,{onClick:e[2]||(e[2]=l=>v.value=!1)},{default:a(()=>[...e[7]||(e[7]=[w("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:B,loading:P.value},{default:a(()=>[...e[8]||(e[8]=[w(" 确认创建 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(V,{ref_key:"createFormRef",ref:M,model:i.value,rules:N,"label-width":"100px"},{default:a(()=>[t(d,{label:"需求池名称",prop:"name"},{default:a(()=>[t(n,{modelValue:i.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>i.value.name=l),placeholder:"请输入需求池名称（1-100字符）",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(d,{label:"需求池描述",prop:"description"},{default:a(()=>[t(n,{modelValue:i.value.description,"onUpdate:modelValue":e[1]||(e[1]=l=>i.value.description=l),type:"textarea",rows:4,placeholder:"请输入需求池描述（可选，最多500字符）",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},fe=j(ue,[["__scopeId","data-v-c6613430"]]);export{fe as default};
